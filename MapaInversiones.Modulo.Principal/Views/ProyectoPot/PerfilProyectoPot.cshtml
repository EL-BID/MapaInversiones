@inject OrchardCore.IOrchardHelper Orchard
@inject Microsoft.Extensions.Configuration.IConfiguration Configuration
@model PlataformaTransparencia.Modelos.ModelProjectProfile
@using PlataformaTransparencia.Negocios.Comunes
@inject ICdnService Cdn


@{
    ViewBag.Title = "Proyecto " + @Truncate(Model.ProjectInformation.name, 20) + " en " + @Model.ProjectInformation.location + "";
    ViewBag.SectionId = "section-projects";
    ViewBag.ProjectsSelected = "selected";
    System.IFormatProvider cultureCountry = new System.Globalization.CultureInfo("es-CO");

    var beneficiarios = "";

    string Truncate(string input, int length)
    {
        if (input == null)
        {
            return "";
        }
        else if (input.Length <= length)
        {
            return @input;
        }
        else
        {
            return @input.Substring(0, length) + "...";
        }
    }

}

<input type="hidden" id="hdIdProyecto" value="@Model.ProjectInformation.ProjectId" />
<input type="hidden" id="hdNomUsuario" value="" />
<input type="hidden" id="hdIdUsuario" value="" />
<body>
    <!--MAIN BANNER-->
        <section id="s0" class="banner-main-section s0-section" style="background-image: url(@Model.urlImgBackground)">
        <div class="bgBlueOverlay op-80">&nbsp;</div><!-- DON'T EREASE-->
        <div class="container">
            <!-- Begin bread crumbs -->
            <nav class="bread-crumbs">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <ul class="bread-crumbs-list">
                                <li>
                                    <a href="\">Inicio</a>
                                    <i class="material-icons md-18">chevron_right</i>
                                </li>
                                <li><a href="/MapView">Mapa de Inversión Pública</a><i class="material-icons md-18">chevron_right</i></li>
                                <li>
                                    <a>
                                        @if (@Model.ProjectInformation.name != null)
                                        {
                                            @Model.ProjectInformation.name.Trim();
                                        }
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- End bread crumbs -->
            <div class="row justify-content-center">
                <div class="col-lg-12">
                    <div class="banner-main-info">
                        <div class="banner-main-title">
                            <h1 class="text-center">
                                @if (@Model.ProjectInformation.name != null)
                                {
                                    @Model.ProjectInformation.name.Trim();
                                }
                            </h1>
                        </div>
                        <div class="banner-main-desc text-center">
                            <div class="sub_t1_red text-center">
                                @Model.ProjectInformation.TipoDeProyecto
                            </div>
                        </div>
                        <div class="banner-main-desc text-center">
                            <div class="sub_t1_red text-center">
                                Sector: @Model.ProjectInformation.sector
                            </div>
                        </div>

                        <div class="banner-main-desc text-center">
                            @{
                                var cant_upl = Model.ProjectInformation.EntesBeneficiados.Where(r => r.Tipo == "MUNICIPIO").Count();
                                var upl = "";
                                var upl2 = "";
                            }
                            <div class="sub_t1_red text-center">
                                @if (cant_upl > 0)
                                {
                                    <text>
                                        UPL:
                                    </text>

                                    
                                }

                                @if (cant_upl > 0)
                                {
                                    upl = Model.ProjectInformation.EntesBeneficiados.Where(r => r.Tipo == "MUNICIPIO").First().Nombre.Split("(")[0];                                 
                                }

                                @foreach (var item in Model.ProjectInformation.EntesBeneficiados.Where(r => r.Tipo=="MUNICIPIO"))
                                 {
                                        upl2 = @item.Nombre.Split("(")[0];
                                        if (upl != upl2)
                                         {
                                            <text> 
                                                 @upl
                                            </text>

                                            upl = upl2;
                                        }
                                        
                                    }
                                @{<text>
                                    @upl
                                </text>
                                }
                            </div>
                        </div>
                        <div class="sub_t2_red text-center">
                            @{ 
                                var cant_items = Model.ProjectInformation.EntesBeneficiados.Where(r => r.Tipo=="DEPARTAMENTO").Count();
                                var count = 0;
                            }
                            @if (cant_items > 0)
                            {
                                <text>
                                    Localidad:
                                </text>

                            }

                            @if (cant_items < 5)
                                {
                                    foreach (var item in Model.ProjectInformation.EntesBeneficiados.Where(r => r.Tipo=="DEPARTAMENTO"))
                                    {
                                        if (count < cant_items - 1)
                                        {
                                           <text> 
                                             @item.Nombre.Split("-")[0], 
                                            </text>
                                           
                                        }
                                        else
                                        {
                                            @item.Nombre.Split("-")[0]                                     
                                        }

                                        count++;
                                    }

                                }
                                else
                                {

                                    foreach (var item in Model.ProjectInformation.EntesBeneficiados.Where(r => r.Tipo=="DEPARTAMENTO"))
                                    {
                                            if (count <= 2)
                                            {
                                                <text>        
                                                        @item.Nombre.Split("-")[0], 
                                                </text>
                                            }

                                        beneficiarios += ""+@item.Nombre.Split("-")[0]+", ";
                                        count++;
                                    }

                                    if (count > 2)
                                    {
                                        <text>  y  <a href="#benefi">otros @String.Format("{0}", @count - 3)</a> </text>
                                    }
                                
                                }
                        </div>
                        <ul class="list-inline details">
                            <li>
                                 <span class="h3" id="">@Model.ProjectInformation.Horizonte</span>
                                <div class="h6">Horizonte POT</div>
                            </li>
                            <li>
                                <span class="h3" id="lblCostoEstimado">$ @ManejoNumeros.EscalaNumericaString((double) Model.ProjectInformation.TotalValue, Convert.ToString(Configuration["FormatearNumeros:Cultura"]),1,1)</span>
                                <div class="h6">Total meta plan de desarrollo</div>
                            </li>
                          
                        </ul>
                    </div>
                </div>
            </div>

        </div>

    </section>
    <!-- Informacion Proyecto -->
     <section class="s1E-section whiteBg" id="s1">
        <div class="container">
            <div class="row sep mb-4">
                <div class="section-heading heading-left">
                    <h2>Información General</h2>
                </div>
                <!--GENERAL INFO COLUMN-->
                <div class="col-lg-4">
                    <div class="card description-box mb-4">
                        <div class="section-heading-Project">
                      
                                <ul class="listDetail">
                                    <li class="data-list text-center">
                                    <img src=" ..\img\Pot\img-logo-Pot.png" /><br />
                                    <span class="label-desc potgreen">Este proyecto ayuda al cumplimiento del</span><br />
                                    <span class="label-desc potgreen potNumber">Objetivo @Model.PlanOrdenamientoTerriotrial[0].CodigoObjetivoEstrategicoPOT</span>
                                    <span class="text-desc">@Model.PlanOrdenamientoTerriotrial[0].ObjetivoEstrategicoPOT</span>
                                    </li>
                                   
                                    <li class="data-list">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <span class="label-desc">Estado</span>
                                                <span class="text-desc">@Model.ProjectInformation.Status</span>
                                            </div>

                                        </div>
                                    </li>
                                    <li class="data-list">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <span class="label-desc">Sector</span>
                                                <span class="text-desc">@Model.ProjectInformation.sector</span>
                                            </div>

                                        </div>
                                    </li>
                                    <li class="data-list">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <span class="label-desc">Entidad</span>
                                                <span class="text-desc">@Model.ProjectInformation.NombreActor</span>
                                            </div>

                                        </div>
                                    </li>
                                     @if (beneficiarios.Trim() != "")
                                     {
                                        <text>
                                        <li class="data-list" >
                                            <span class="label-desc"><strong>Localidades</strong></span>
                                            <span class=""><br>@Html.Raw(@beneficiarios.Substring(0, @beneficiarios.Length - 1))</span>


                                        </li>
                                        </text>
                                     }
                                
                                </ul>
                            </div>

                        </div>

                </div>
                <!--GRAPH SIDE-->
                <div class="col-lg-8">
                    <!--Descripcion-->
                    <div class="mb-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="heading-Project">
                                    <h3>Descripción de la inversión</h3>
                                    <p>@Model.ProjectInformation.objGeneral</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--Articulacion-->

                    <div class="card description-pot">
                        <div class="card-body">
                            <div class="heading-Project">
                                <h3>Articulación en el POT</h3>
                                <h4>Estrategia</h4>
                            </div>
                            <p>@Model.PlanOrdenamientoTerriotrial[0].EstrategiaPOT</p>
                            <div class="container-fluid py-4">
                                <div class="row g-3">
                                    <!-- Programa -->
                                    <div class="col-lg-4 col-md-6 col-12">
                                        <div class="program-card programa">
                                            <div class="program-title">Programa</div>
                                            <div class="program-description">
                                                @Model.PlanOrdenamientoTerriotrial[0].ProgramaPOT
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Subprograma -->
                                    <div class="col-lg-4 col-md-6 col-12">
                                        <div class="program-card subprograma">
                                            <div class="program-title">Subprograma</div>
                                            <div class="program-description">
                                                @Model.PlanOrdenamientoTerriotrial[0].SubProgramaPOT
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Meta subprograma -->
                                    <div class="col-lg-4 col-md-12 col-12">
                                        <div class="program-card meta">
                                            <div class="program-title">Meta subprograma</div>
                                            <div class="program-description">
                                                @Model.PlanOrdenamientoTerriotrial[0].MetaSubprogramaPOT
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="wrap-vinculacion py-4">
                        <div class="heading-Project">
                            <h3>Vinculación al Plan de Desarrollo Distrital 2024 - 2027</h3>
                        </div>
                        <div class="container-fluid py-4">
                            <div class="row g-3">
                                <!-- Programa -->
                                <div class="col-lg-4 col-md-6 col-12">
                                    <div class="program-card programa">
                                        <div class="program-title">Objetivo @Model.PlanDesarrollo[0].CodigoObjetivoPlanDesarrollo </div>
                                        <div class="program-description">
                                            @Model.PlanDesarrollo[0].ObjetivoPlanDesarrollo
                                        </div>
                                    </div>
                                </div>

                                <!-- Subprograma -->
                                <div class="col-lg-4 col-md-6 col-12">
                                    <div class="program-card subprograma">
                                        <div class="program-title">Programa</div>
                                        <div class="program-description">
                                            @Model.PlanDesarrollo[0].ProgramaPlanDesarrollo
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="wrap-vinculacion py-4">
                        <div class="heading-Project">
                            <h4>Meta</h4>
                        </div>
                        <p>@Model.PlanDesarrollo[0].MetaPlanDesarrollo</p>
                        <div class="heading-Project">
                            <h5>Metas programadas por años</h5>
                        </div>
                        <div class=" container-fluid py-4">
                            <div class="row g-4 align-items-stretch">

                                @foreach (var plande in Model.PlanDesarrollo.OrderBy(x => x.Anio))
                                {

                                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                        <div class="meta-card">
                                            <div class="meta-year">Meta @plande.Anio</div>
                                            <div class="meta-amount">$ @ManejoNumeros.EscalaNumericaString(plande.ProgramadoMeta, Convert.ToString(Configuration["FormatearNumeros:Cultura"]),1,1) </div>
                                        </div>
                                    </div>

                                }

                                <!-- Meta 2024 -->
                                @*                                 <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="meta-card">
                                        <div class="meta-year">Meta 2024</div>
                                        <div class="meta-amount">XXX.XXX Millones</div>
                                    </div>
                                </div>



                                <!-- Meta 2025 -->
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="meta-card">
                                        <div class="meta-year">Meta 2025</div>
                                        <div class="meta-amount">XXX.XXX Millones</div>
                                    </div>
                                </div>


                                <!-- Meta 2026 -->
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="meta-card">
                                        <div class="meta-year">Meta 2026</div>
                                        <div class="meta-amount">XXX.XXX Millones</div>
                                    </div>
                                </div>



                                <!-- Meta 2027 -->
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="meta-card">
                                        <div class="meta-year">Meta 2027</div>
                                        <div class="meta-amount">XXX.XXX Millones</div>
                                    </div>
                                </div> *@
                            </div>
                        </div>
                    </div>      
                </div>

            </div>
        </div>
    </section> 
    

    <!--Ordenes de Pago-->
    <section class="section" id="s2">
        <div class="container">
            <div class="section-heading heading-left">
                <h2>Listado de proyectos de inversión asociados</h2>
            </div>
            <div class="row">
                <div class="col-lg-12 text-center">
                    
                    <div class="comparativeTable">
                        <div class="card-entidades-group" id="listproyectos">
@*                             <div class="card d-flex cardborder">
                                <div class="headEnt">
                                    <div class="data1 mainDataEntidad2">
                                        <span class="labelTit">Localidad</span>
                                        <span class="td1">Usaquen</span>
                                    </div>
                                    <div class="data1">
                                        <span class="labelTit">Presupuesto</span>
                                        <span class="td1">$124 Millones</span>
                                    </div>
                                    <div class="data1">
                                        <span class="labelTit">Compromisos</span>
                                        <span class="td1">$60 Millones</span>
                                    </div>
                                    <div class="data1">
                                        <span class="labelTit">Giros</span>
                                        <span class="td1">$14 Millones</span>
                                    </div>
                                </div>
                                <div class="btn-action">
                                    <div class="btnPerfil">
                                        <a class="text-small"><i class="material-icons md-18">arrow_forward</i><br /><span>Ver perfil</span></a>

                                    </div>
                                </div>
                            </div>
                            <div class="card d-flex cardborder">
                                <div class="headEnt">
                                    <div class="data1 mainDataEntidad2">
                                        <span class="labelTit">Localidad</span>
                                        <span class="td1">Usaquen</span>
                                    </div>
                                    <div class="data1">
                                        <span class="labelTit">Presupuesto</span>
                                        <span class="td1">$124 Millones</span>
                                    </div>
                                    <div class="data1">
                                        <span class="labelTit">Compromisos</span>
                                        <span class="td1">$60 Millones</span>
                                    </div>
                                    <div class="data1">
                                        <span class="labelTit">Giros</span>
                                        <span class="td1">$14 Millones</span>
                                    </div>
                                </div>
                                <div class="btn-action">
                                    <div class="btnPerfil">
                                        <a class="text-small"><i class="material-icons md-18">arrow_forward</i><br /><span>Ver perfil</span></a>

                                    </div>
                                </div>
                            </div>
                            <div class="card d-flex cardborder">
                                <div class="headEnt">
                                    <div class="data1 mainDataEntidad2">
                                        <span class="labelTit">Codigo BPIN: </span>
                                        <span class="td1">Usaquen</span>
                                    </div>
                                    <div class="data1">
                                        <span class="labelTit">Sector</span>
                                        <span class="td1">$124 Millones</span>
                                    </div>
                                    <div class="data1">
                                        <span class="labelTit">UPL</span>
                                        <span class="td1">$60 Millones</span>
                                    </div>
                                    <div class="data1">
                                        <span class="labelTit">Estado Proyecto</span>
                                        <span class="td1">$14 Millones</span>
                                    </div>
                                </div>
                                <div class="btn-action">
                                    <div class="btnPerfil">
                                        <a class="text-small"><i class="material-icons md-18">arrow_forward</i><br /><span>Ver perfil</span></a>

                                    </div>
                                </div>
                            </div> *@
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>
    <!--fin ordenes de pago-->
    <!-- Fotos Oficiales Section -->
    <section class="section section-bg2" id="s3">
        <div class="container">
            <div class="section-heading heading-left">
                <h2>Fotos oficiales</h2>
            </div>
            @if (Model.Images.Count() == 0)
            {
                <text>
                    <div class="empty-gallery">No existen imágenes aún para este obra</div>
                </text>
            }
            else
            {
                <div class="project-carusel w2col" data-flickity='{ "imagesLoaded": true, "pageDots": false, "lazyLoad": true, "lazyLoad": 10, "groupCells": true, "contain": true, "contain": true, "prevNextButtons": true }'>
                    @foreach (var photo in Model.Images)
                    {
                        <!--ITEM 1-->
                        <div class="project-col gallery-col-carusel">
                            <!-- Begin project item -->
                            <div class="gallery-card">
                                <div class="thumbnail type5">

                                    <div class="enlace_img" descrip="@photo.description" data-src="@photo.large" style="background-image: url('@photo.large')">
                                        <div class="btn-zoom" data-toggle="modal" data-target="#FotoModalOficial">
                                            <div class="ic-gal"><i class="material-icons md-48">zoom_in</i></div>
                                        </div>
                                        <div class="labelCategory">
                                            <div class="d-flex">
                                                <div class="desc-gal">
                                                    <span class="clearfix">Subido el @photo.fechaFoto</span>
                                                    <span class="text-elipsis">@photo.description</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>

                                </div>
                            </div><!-- End project item -->
                        </div>

                    }
                </div>

            }
            <div id="FotoModalOficial" class="modal fade" data-backdrop="static" data-keyboard="false" role="dialog">
                <div class="modal-dialog MIVBox">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Fotos Oficiales</h3>
                            <button type="button" id="btnCloseFotoModalOficial" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="divDatosModalOficial">
                            <img class="img-fluid" id="img-modal-oficial" alt="imagen complementaria" src="">
                            <div id="des-oficial"></div>
                        </div>
                    </div>
                </div>
            </div>


            <!--MODAL 2-->
            <div id="popup1" class="popup_style popup_style_wide popup_style_sally open_popup" style="display:none;">
                <div class="popup">
                    <div class="popup_content">
                        <h4 class="popup_title">Tipos de presupuesto</h4>
                        <div class="content2">
                            <ul>
                                <li><span class="text-bold">Presupuesto asignado/vigente:</span> <br />Es el total de recursos/dinero que la Alcaldía destinó para el desarrollo de un obra y que puede ejecutarse mediante diferentes contratos. Similar a cuando destinás una parte de tu salario para una actividad en específico como salir a comer con tu pareja.</li>
                                <li>
                                    <span class="text-bold">Presupuesto ejecutado:</span>  <br />Es el dinero que la Alcaldía ha pagado al proveedor para el desarrollo de un obra o la entrega de un servicio. Es decir, la cantidad de dinero que gastaste de lo que habías asignado para salir a comer con tu pareja.
                                </li>
                                <li>
                                    <span class="text-bold">Presupuesto obligado:</span>  <br />Es el dinero que la Alcaldía se comprometió a pagar a un proveedor por el desarrollo de una obra y/o la entrega de un servicio. Similar a cuando suscribís un contrato de arrendamiento para pagar una suma en específico al dueño de la casa mes a mes.
                                </li>

                            </ul>
                        </div>
                    </div>
                    <div class="popup1_close popup_close"><i class="material-icons md-24">close</i></div>
                </div>
            </div>

        </div>
    </section>
    <div class="clearfix"></div>

    <!-- Fotos de los ciudadanos Section -->
    <section class="section section-bg2" id="s3">

        <div class="container">
            <div class="section-heading heading-left">
                <h2 class="mb-3">Fotos cargadas por los ciudadanos </h2>
            </div>
            @if (Model.FotosU.Count() == 0)
            {
                <text>
                    <div class="empty-gallery">No existen imágenes aún para este obra</div>
                </text> }
            else
            {
                <div class="project-carusel w2col" data-flickity='{ "imagesLoaded": true, "pageDots": false, "lazyLoad": true, "lazyLoad": 10, "groupCells": true, "contain": true, "contain": true, "prevNextButtons": true }'>
                    @foreach (var photo in Model.FotosU)
                    {
                        <!--ITEM 1-->
                        <div class="project-col gallery-col-carusel">
                            <!-- Begin project item -->
                            <div class="gallery-card">
                                <div class="thumbnail type5">

                                    <div class="enlace_img_ciudadanos" descrip="@photo.description" data-src="@photo.large" style="background-image: url('@photo.large')">
                                        <div class="btn-zoom" data-toggle="modal" data-target="#FotoModalCiudadano">
                                            <div class="ic-gal"><i class="material-icons md-48">zoom_in</i></div>
                                        </div>
                                        <div class="labelCategory">
                                            <div class="d-flex">
                                                <div class="desc-gal">
                                                    <span class="clearfix">Subido el @photo.fechaFoto</span>
                                                    <span class="text-elipsis">@photo.description</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>

                                </div>
                            </div><!-- End project item -->
                        </div>

                    }
                </div>
            }
            <!--BOTONERA-->
            <div class="col-md-12">
                <div class="filtersBox">
                    <div class="row">

                        <div class="col-md-12 text-center py-5" id="divFotoUsuario">
                            <a class="btn btn-outlined btn-simple" id="btnSubirFoto_AUX" role="button"><i class="material-icons md-24">add_photo_alternate</i> SUBIR FOTO</a>
                            <button type="button" class="btn outlined btn-simple" id="btnSubirFoto" data-toggle="modal" data-target="#myModal" role="button" style="display:none;"><i class="material-icons md-24">add_photo_alternate</i> SUBIR FOTO2
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!--MODAL-->
            <div id="FotoModalCiudadano" class="modal fade" data-backdrop="static" data-keyboard="false" role="dialog">
              <div class="modal-dialog MIVBox">
                <!-- Modal content-->
                <div class="modal-content">
                  <div class="modal-header">
                    <h3 class="modal-title">Fotos Ciudadanas</h3>
                    <button type="button" id="btnCloseFotoModalCiudadano" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" id="divDatosModalCiudadano">
                    <img class="img-fluid" id="img-modal-ciudadano" alt="imagen complementaria" src="">
                    <div id="des-ciudadano"></div>
                  </div>
                </div>
              </div>
            </div>


            <div id="myModal" class="modal fade" data-backdrop="static" data-keyboard="false" role="dialog">
                <div class="modal-dialog MIVBox">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" id="btnCloseFotos" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"><i class="material-icons md-24">add_photo_alternate</i> Subir Foto</h4>
                        </div>
                        <div class="modal-body" id="divDatosModal">
                            <div class="form-group">
                                <label for="filtro_AreaFotoUsuUpload">Seleccione el ente territorial:</label>
                                <select id="filtro_AreaFotoUsuUpload" class="form-control">
                                    @if (Model.ProjectInformation.EntesBeneficiados.Count() > 0)
                                    {
                                        foreach (var item in Model.ProjectInformation.EntesBeneficiados)
                                        {
                                            <option value="@(item.IdMunicipio)*@(item.IdDepartamento)"> @item.Nombre </option>

                                        }
                                    }
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="tbDescripcion">Realice una descripción relacionada con la imagen:</label><br>
                                <textarea class="form-control" rows="5" id="tbDescripcion"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="fileUpload">Seleccione la imagen que desea subir:</label><br>
                                <input class="form-control" type="file" name="FileUpload1" id="fileUpload" accept="image" />
                            </div>

                        </div>
                        <div class="modal-footer">
                            <div class="form-group">
                                <input id="btnUploadFile" class="btn btn-primary" type="button" value="GUARDAR" />
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>
    <div class="clearfix"></div>

    <!-- Participación ciudadana -->
    <section id="s4" class="section">
        <div class="container">
            <div class="section-heading heading-center">
                <h2 class="mb-4">Tu participación es importante para nosotros</h2>
                <p class="section-subheading">Participa dejando tu comentario sobre este proyecto</p>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-7 col-lg-7 user-form-login mb-4">
                    <!--usuario logueado-->
                    <div id="divUsuarioLog">
                        <div class="light-bg">
                        </div>

                    </div>

                    <!--usuario sin loguear este div se debe ocultar cuando ya el usuario está logueado-->
                    <div class="user-wrap">
                        <div class="wrap-btn">
                            <a id="btnLoginGab" class="btn btn-link">Iniciar sesión</a>
                            <a id="btnUserGab" target="_blank" rel="noopener" href="@Convert.ToString(Configuration["GabAuth:UserRegister"])" class="btn btn-outlined">Registrarse</a>
                        </div>
                    </div>
                    <!--SURVEY-->
                    <div class="light-bg">
                        <div id="divPregParticipacion" class="objHidden">
                            <div class="p-3">
                                <h3 id="divNomUsuarioLog"></h3><br>
                                <br>

                                <div id="divTipoComentario" class="form-group">
                                    <label for="filtro_TipoCometario" class="required">Tipo de comentario:</label>
                                    <select class="form-select" aria-label="Selecciona un tipo comentario" id="filtro_TipoCometario">
                                        <option id_tipo="" class="selected">Tipo</option>
                                        @if (Model.tipo_comentario.Count() > 0)
                                        {
                                            @foreach (var item in Model.tipo_comentario)
                                            {
                                                <option id_tipo="@item.idTC">@item.nameTC</option>
                                            }
                                        }

                                    </select>
                                </div>
                                <div class="highlightBox">
                                    <div id="divAreaInfluencia" class="form-group">
                                        <label for="sel_area_influencia" class="required">Municipio afectado:</label>
                                        <select class="form-select" aria-label="Selecciona un tipo comentario" id="filtro_AreaInfluencia">
                                            <option id_munic="" id_depa="" class="selected">Área</option>
                                            @if (Model.ProjectInformation.EntesBeneficiados.Count() > 0)
                                            {
                                                @foreach (var item in Model.ProjectInformation.EntesBeneficiados)
                                                {
                                                    <option id_depa="@item.IdDepartamento">@item.Nombre</option>
                                                }
                                            }

                                        </select>

                                    </div>

                                </div>
                               
                                <div class="mb-4">
                                    <label for="txtcomentario" class="required">Escribe tu comentario:</label>
                                    <div id="divComentario">
                                        <textarea rows="4" class="txtAbierto form-control" id="txtcomentario" name="" value="" id_tipo=""></textarea>
                                    </div>
                                </div>
                                <div class="disclaimer well">
                                    <span class="material-icons">info</span>
                                    <p>Se informa que los comentarios de su participación antes de ser publicados serán validados por Gobierno Abierto Bogotá. Si desea, su opinión puede ser anónima. </p>
                                </div>
                                <div class="py-3">
                                    <input type="checkbox" id="anonimo" class="" /> Anónimo
                                </div>
                                <div class="form-group text-center">
                                    <button type="button" class="btn btn-primary" id="btnGuardarComent"> ENVIAR </button><br><br>
                                    <a href="">CANCELAR</a>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!--CONFIRM-->
                     <div id="divConfirmaEnvio" style="display:none;">
                        <div class="light-bg">
                            <div class="p-3 text-center">
                                <img src="@Cdn.Url(Url, "~/content/img/icSuccess.jpg")" /><br><br>
                                <span class="h3 orangeLink" id="txtMsgConfirmaEnvio"></span><br>
                                <span class="h4">Tu comentario será publicado cuando el administrador lo verifique</span>
                                <div class="closeSesion"><a href="../../" class="btn btn-default">Comentar otro proyecto</a></div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center closeSesion" id="divCloseSesion" style="display:none;">
                        <a role="button" id="enlace_cierre"><i class="material-icons md-24">logout</i> Cerrar Sesión </a></div>
                </div>
                <div class="col-md-7 col-lg-7 s2" id="divComentarios">
                    <div class="Tcomments">
                        <div class="lcomments">
                            <span class="h3" id="txtNumComentarios"> </span>
                            <span class="h3">Total Comentarios </span>
                        </div>
                    </div>
                    <div id="content-2" class="content mCustomScrollbar" data-mcs-theme="dark">

                    </div>

                </div>
            </div>

        </div>

    </section>
    <div class="clearfix"></div>
    <!-- Fin Participación ciudadana -->
        <!-- obraS RELACIONADOS -->
@*     <section class="section proy-relacionados section-bg2">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-heading heading-center">
                        <h2 class="mb-4">Proyectos que te pueden interesar</h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div id="divContenedorFichas" class="project-carusel carouselData" data-flickity='{ "initialIndex": 0, "pageDots": false, "groupCells": true, "contain": true, "prevNextButtons": true , "freeScroll":true,"wrapAround":false }'>
                    </div>
                    <!--END MAQUETA BASICA PROJECTOS-->
                    <div id="divNoEncontradoEjec" class="no-search-results objHidden">No se encontraron resultados</div>
                    <div id="divNoExistenEjec" class="no-search-results objHidden">
                        No se encontraron resultados
                    </div>
                </div>
                <div class="section-btns justify-content-center py-3">
                    <a href="/BusquedaResultados?SearchString=%27%27&type=obra" class="btn btn-primary">
                        <span>Buscar obras</span>
                        <svg class="btn-icon-right" viewBox="0 0 13 9" width="13" height="9">
                            <use xlink:href="img/sprite.svg#arrow-right"></use>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </section> *@

    <div class="clearfix"></div>
    <script src="@Cdn.Url(Url, "~/js/lib/D3/d3.min.js")" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3plus@2" integrity="sha384-c1J7R3OBhP9G7a0SkXCaVW1lVtOHAOuukFed365bi4B0GwZvKL2hd8mjE7tRMl2U" crossorigin="anonymous"></script>
    <script src="@Cdn.Url(Url, "~/js/bootstrap/3.3.5/bootstrap.min.js")" type="text/javascript"></script>
    <script src="@Cdn.Url(Url, "~/js/Bootbox/bootbox.min.js")" type="text/javascript"></script>
    <script type="text/javascript" src="@Cdn.Url(Url, "~/js/proyectospot_aux.js")"></script>



    <script type="text/javascript">

        $(document).ready(function () {
            $('#btnUploadFile').on('click', function () {
                var data = new FormData();
                var maxFileSize = 10485760; // 10MB ->  1024 * 1024
              var files = $("#fileUpload").get(0).files;
              console.log("Entro por clic:");
                // Add the uploaded image content to the form data collection
                if (files.length > 0)
                {
                  console.log("Entró por files:");
                    //using(var ms = new MemoryStream())
                    //{
                    //  files[0].CopyTo(ms);
                    //  var fileBytes = ms.ToArray();
                    //  string s = Convert.ToBase64String(fileBytes);
                    //  console.log("Imagen:" + s);
                    //  // act on the Base64 data
                    //}

                    if (files[0].size < maxFileSize) {
                        /*data.append("UploadedImage", files[0]);
                        data.append("DescripcionImage", $('#tbDescripcion').val());
                        data.append("LocationImage", $('#filtro_AreaFotoUsuUpload option:selected').val());*/
                        //data.append("ProjectImage",@Model.idproject);
                      console.log(files[0]);


                      var reader = new FileReader();
                      const fileByteArray = [];
                      reader.readAsArrayBuffer(files[0]);
                      reader.onloadend = (evt) => {
                        if (evt.target.readyState === FileReader.DONE) {
                          const arrayBuffer = evt.target.result,
                            array = new Uint8Array(arrayBuffer);
                          for (const a of array) {
                            fileByteArray.push(a);
                          }
                          var params_img = {
                            UploadedImage: fileByteArray,
                            DescripcionImage: $('#tbDescripcion').val(),
                            LocationImage: $('#filtro_AreaFotoUsuUpload option:selected').val(),
                            ProjectImage:@Model.idproject,
                            TipoImage:"Usuario"
                                };
                          $.ajax({
                            type: 'POST',
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            url: "/api/ServiciosParticipacion/SubirArchivo",
                            cache: false,
                            data: JSON.stringify(params_img),
                            success: function (result) {
                              //separa error y mensaje
                              var cad_result = result.message.split("<||>");
                              if (cad_result.length > 1) {
                                var cod_error = cad_result[0];
                                var mensaje_error = cad_result[1];
                                if (cod_error == "0") {
                                  bootbox.alert(mensaje_error, function () {
                                    $('select,input[type=text],input[type=radio],textarea', $('#divDatosModal')).each(function (i, e) {
                                      $(e).val("");
                                    });
                                    $("#btnCloseFotos").trigger("click");
                                  });
                                } else {
                                  bootbox.alert(mensaje_error);
                                }
                              } else {
                                bootbox.alert(result);
                              }
                            },
                            error: function (response) {
                              bootbox.alert('Error: ' + response.responseText);
                            },
                            failure: function (response) {
                              bootbox.alert('Fallo: ' + response.responseText);
                            }
                          });

                        }
                      }
                    }
                    else {
                        var tamanoArchivo = Math.round(files[0].size / maxFileSize);
                        bootbox.alert('Lo sentimos, el archivo tiene un tamaño de ' + tamanoArchivo +' MB y supera el máximo tamaño permitido que es de 1MB.\nPor favor, modifique la imagen disminuyendo el tamaño del archivo antes de subirlo al sistema.');
                    }
                }
                else bootbox.alert('No existe archivo para subir.');
            });

            $('.enlace_img').on('click' , function(e){
                var id = $(this).attr("data-src");
                $('#img-modal').attr("src", id);
                var des = $(this).attr("descrip");


            });
        });
    </script>



    <div id="fb-root"></div>
    <script src="@Cdn.Url(Url, "~/js/jquery/jquery-ui.min.js")"></script>

    @section DataBody {
        data-profile='[{"avance_financiero":"@Model.ProjectInformation.avance_financiero","id_project":"@Model.idproject","idUsuParticipa":"@Model.id_usu_participa" , "nomUsuParticipa" : "@Model.nom_usu_participa"}]'
        data-actores='[@foreach (var info in @Model.actores_proy)
        {
            <text>
                {"idCategoria":"@info.idCategoria","Categoria": "@info.Categoria","nomActor": "@info.nomActor"}@if (info != @Model.actores_proy.Last())
                {
                    <text>,</text>
                }
            </text>
        }
        ]'
     
    }
</body>


