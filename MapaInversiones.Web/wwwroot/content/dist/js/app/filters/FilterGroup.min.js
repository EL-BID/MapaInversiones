define(["lib/mvc/Observable","./Option"],function(n,t){"use strict";var i=document.body.getAttribute("data-periods-default-text");return new Class(n,{initialize:function(n){var r,f=[],u;for($.extend(this,n),this.options=ko.observableArray(),u=0;u<this.items.length;u++){r=new t(this.items[u]),r.active.subscribe(this.setActive.bind(this));r.on("require-activate",this.optionActivated.bind(this));r.on("options-changed",this.optionActivatedByUser.bind(this));f[u]=r}f.sort(this.alphabetSorting),this.options(f),this.active=ko.observable(!1),this.visible=ko.observable(!1),this.optionChanged=ko.observable(),this.elems={},this.getNameStatus=ko.computed(function(){for(var n="",t,r=this.options(),i=r.length;i--;)t=r[i],t.active()&&(n+=t.name+", ");return n?'<span class="no-bold">'+this.name+":  <\/span>"+n.replace(/\,\s$/,""):this.name},this),this.getNameDefault=ko.computed(function(){for(var n="",u=this.options(),t,r=u.length;r--;)t=u[r],t.active()&&(n+=t.name+", ");return n?n.replace(/\,\s$/,""):i},this),this.toggleVisibleBinded=this.toggleVisible.bind(this)},filter:function(){},toggleVisible:function(n,t){var i=t&&$(t.target),r=this.visible();i&&(this.elem=i),this.onToggle(),r?(t&&t.stopPropagation(),this.hide()):this.show(),t instanceof Event&&(t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0)},setActive:function(){var n=this.getActive();this.active(n.length),this.fireEvent("option-activated",this,n)},getActive:function(){for(var i=this.options(),t,r=[],n=0;n<i.length;n++)t=i[n],t.active()&&r.push(t);return r},disActive:function(){for(var i=this.options(),n,t=i.length;t--;)n=i[t],n.active()&&n.setActive(!1)},optionClicked:function(n,t){var i=t.target,r=ko.dataFor(i);$(t.target).hasClass("option")&&r.toggleActive()},optionActivated:function(n){this.fireEvent("activate-options-related",n)},optionActivatedByUser:function(n,t){for(var i,u=this.getActive(),r=u.length;r--;)i=u[r],this.parameter.indexOf("period")==-1&&n.value!==i.value&&i.setActive(!1,"ignoreNotification");t||this.fireEvent("activated-by-user",this.parameter,this.getActive())},getOptionByValue:function(n){for(var i=this.options(),t=0;t<i.length;t++)if(i[t].value===n)return i[t]},filterOptions:function(n,t){for(var u=t.target.value,f=this.options(),r,i=0;i<f.length;i++)r=f[i],r.setVisibility(!u||r.name.score(u)>0)},getQuery:function(){var n,t,i,r;if(this.active()){for(n=this.parameter+"=",t=this.options(),r=t.length;r--;)i=t[r],i.active()&&(n+=i.value+",");return n.replace(/\,$/,"")}return""},onToggle:function(){this.elem.parents(".filters-group").find(".filter-group").end().find("input").val("").keyup()},hide:function(){var n=this;this.onToggle(),$(document).off("click",this.toggleVisibleBinded),n.visible(!1),this.elem.hasClass("extra")?this.elem.next().slideUp(200,function(){$(this).hide().parent().removeClass("visible")}):this.elem.next().delay(100).animate({width:0},250,function(){$(this).hide().parent().removeClass("visible"),n.visible(!1)})},show:function(){var n=this;this.onToggle(),this.visible(!0),this.elem.hasClass("extra")?(this.elem.next().slideDown(200),setTimeout(function(){$(document).on("click",n.toggleVisibleBinded)},10)):this.elem.next().width(0).show().delay(100).animate({width:200},250),this.elem.parent().addClass("visible"),this.fireEvent("filters-gonna-show",this)},alphabetSorting:function(n,t){return n.name==t.name?0:n.name<t.name?-1:1},sortOptionsBy:function(n){var r=this.options(),t,i;for(this.filterByType||(this.filterByType=function(t){for(var u,r,i=0;i<n.length;i++)for(u=n[i].getActive(),r=0;r<u.length;r++)if(n[i].parameter==t.type&&u[r].value==t.id)return!0;return!1}),i=r.length;i--;)t=r[i],t.dependsOn?t.dependsOn.filter(this.filterByType).length?(t.sortBy=1+t.name,t.important(!0)):(t.sortBy=2+t.name,t.important(!1)):(t.sortBy=2+t.name,t.important(!1));this.options.sort(function(n,t){return n.sortBy==t.sortBy?0:n.sortBy<t.sortBy?-1:1})},selectOption:function(n){for(var r=this.options(),t,i=r.length;i--;)t=r[i],t.value==n?t.setActive(!0):this.parameter.indexOf("period")==-1&&t.setActive(!1,"ignoreNotification")}})});
//@ sourceMappingURL=FilterGroup.min.js.map