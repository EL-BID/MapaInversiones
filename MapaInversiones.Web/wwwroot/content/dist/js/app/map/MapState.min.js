define(["lib/mvc/Observable","app/network/Services"],function(n,t){var i=new Class(n,{zoom:null,corners:null,filters:null,query:"",timeout:null,firstTime:!0,listMode:null,projectsReq:null,cornersBackup:null,initialize:function(){},setZoom:function(n){this.listMode&&this.setListMode(!1),this.zoom=n,this.updateQueryTimed()},setCorners:function(n,t){t?(this.corners=n,this.setListMode(!0,t)):(this.cornersBackup=n,this.corners=n,this.setListMode(!1))},setFiltersString:function(n){this.setListMode(!1),this.filters=n,this.updateQueryTimed()},setQuery:function(n){this.setListMode(!1),this.query=n||"",this.updateQueryTimed()},setPage:function(n){this.page=n,this.updateQueryTimed()},updateQuery:function(){var n="";if(this.firstTime){this.firstTime=!1;return}this.query&&(n+="query="+this.query),this.page&&(n+="&page="+this.page),this.zoom&&!this.listMode&&(n+="&zoom="+this.zoom),this.corners&&(!this.listMode||this.listMode.isGroup)&&(n+="&topLeft="+this.corners[0][0]+","+this.corners[0][1],n+="&bottomRight="+this.corners[1][0]+","+this.corners[1][1]),this.filters&&(n+="&"+this.filters),n=n.replace(/(?:^&)|(?:&$)/g,""),this.listMode?t.search.projectsList(n).done(this.projectsListLoaded.bind(this)):(this.projectsReq&&this.projectsReq.readystate!=4&&(this.projectsReq.abort&&this.projectsReq.abort(),this.fireEvent("load-projects-aborded",n)),this.projectsReq=t.search.projects(n),this.projectsReq.done(this.projectsLoaded.bind(this)),this.fireEvent("loading-projects",n))},updateQueryTimed:function(){clearTimeout(this.timeout),this.timeout=setTimeout(this.updateQuery.bind(this),0)},projectsLoaded:function(n){this.fireEvent("projects-loaded",n)},projectsListLoaded:function(n){this.fireEvent("projects-list-loaded",n)},setListMode:function(n,t){n?(this.listMode=t?{isGroup:!0}:{},$("#map-view").hide(),$("#projects-list-view").show(),$("#controls").addClass("list-mode").animate({marginLeft:0,left:0})):(this.listMode=null,this.page=0,$("#projects-list-view").hide(),$("#map-view").show(),$("#controls").removeClass("list-mode"),this.corners=this.cornersBackup),this.updateQueryTimed(t)}});return new i});
//@ sourceMappingURL=MapState.min.js.map