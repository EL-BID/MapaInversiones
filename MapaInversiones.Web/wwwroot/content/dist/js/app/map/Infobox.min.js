define(function(){"use strict";function f(n){t=new Microsoft.Maps.Point(n.getX(),n.getY())}function n(n,t,i,r){this._type=n,this._map=t,this._entity=i,this.name=r.name,this.id=r.id,this._content=$.extend(null,r),Microsoft.Maps.Events.addThrottledHandler(i._polygon||i,"click",this.clickHandler.bind(this),200),Microsoft.Maps.Events.addHandler(t,"mousedown",f),Microsoft.Maps.Events.addHandler(t,"viewchange",this.hide.bind(this))}var i={info:doT.compile($("#template-infobox-info")[0].innerHTML),project:doT.compile($("#template-infobox-project")[0].innerHTML),group:doT.compile($("#template-infobox-group")[0].innerHTML)},t,r=jQuery.browser.msie&&jQuery.browser.version.match(/^9/),u=jQuery.browser.msie&&jQuery.browser.version.match(/^10/);return n.prototype.show=function(n){var f=$("#header")[0].offsetHeight,i,t;this._map.visibleInfobox&&this._map.visibleInfobox.hide(),this.createElement(),this._elem.appendTo(document.body);this._elem.find(".button").on("click",this.viewMoreHandler.bind(this));this._type=="info"?((typeof n.pageX!="number"||isNaN(n.pageX))&&(n.pageX=n.originalEvent.x,n.pageY=n.originalEvent.y),(u||r)&&(n.pageY=n.pageY+window.pageYOffset),this._elem.css({display:"block",left:n.pageX,top:n.pageY}).removeClass("to-the-left").removeClass("to-the-top"),window.outerWidth-n.pageX-this._elem[0].offsetWidth<0&&this._elem.css({left:n.pageX-this._elem[0].offsetWidth}).addClass("to-the-left"),window.outerHeight-n.pageY-this._elem[0].offsetHeight+f<0&&this._elem.css({top:n.pageY-this._elem[0].offsetHeight+30}).addClass("to-the-top")):this._type=="project"?(i=this._entity.getLocation(),t=this._map.tryLocationToPixel(i,Microsoft.Maps.PixelReference.control),this._elem.css({display:"block",left:t.x,top:t.y}).removeClass("to-the-left").removeClass("to-the-top"),window.outerWidth-t.x-this._elem[0].offsetWidth<0&&this._elem.css({left:t.x-this._elem[0].offsetWidth}).addClass("to-the-left"),window.outerHeight-t.y-this._elem[0].offsetHeight+f<0&&this._elem.css({top:t.y-this._elem[0].offsetHeight+43}).addClass("to-the-top")):this._type=="group"&&(i=this._entity.getLocation(),t=this._map.tryLocationToPixel(i,Microsoft.Maps.PixelReference.control),this._elem.css({display:"block",left:t.x,top:t.y}).removeClass("to-the-left").removeClass("to-the-top"),window.outerWidth-t.x-this._elem[0].offsetWidth<0&&this._elem.css({left:t.x-this._elem[0].offsetWidth}).addClass("to-the-left"),window.outerHeight-t.y-this._elem[0].offsetHeight+f<0&&this._elem.css({top:t.y-this._elem[0].offsetHeight+43}).addClass("to-the-top")),this._map.visibleInfobox=this,this.visible=!0,n instanceof Event&&(n.stopPropagation?n.stopPropagation():window.event.cancelBubble=!0)},n.prototype.hide=function(){this._elem&&this.visible&&(this._elem.css({display:"none"}),this.visible=!1,this._elem.remove())},n.prototype.clickHandler=function(n){var i=new Microsoft.Maps.Point(n.getX(),n.getY()),r=Math.sqrt(Math.pow(i.x-t.x,2),Math.pow(i.y-t.y,2));r>5||(this.toggle(n),n instanceof Event&&(n.stopPropagation?n.stopPropagation():window.event.cancelBubble=!0))},n.prototype.viewMoreHandler=function(n){return this._type=="group"?(this._entity.viewGroupList({latitude:this._content.latitude,longitude:this._content.longitude}),this.hide()):(this._entity.panIntoView&&(n=n.originalEvent,this._entity.panIntoView(),n.preventDefault?n.preventDefault():n.returnValue=!1),this._entity.select&&this._entity.select()),!1},n.prototype.toggle=function(n){this.visible?this.hide(n):this.show(n)},n.prototype.updateContent=function(n){n.name=this.name,this._content=$.extend(null,n),this._elem&&this.hide()},n.prototype.createElement=function(){var n=this._type,t=this._content,u=i[n]?i[n](t):t,r=document.createElement("div");r.innerHTML=u,this._elem=r.childNodes[0],this._elem.style.display="none",this._elem=$(this._elem)},n});
//@ sourceMappingURL=Infobox.min.js.map