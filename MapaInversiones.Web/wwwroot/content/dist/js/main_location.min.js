define("lib/mvc/Observable",[],function(){var n=function(){this._events={}};return n.prototype.on=function(n,t){this._events[n]||(this._events[n]=[]),this._events[n].push(t)},n.prototype.off=function(n,t){var i;this._events[n]&&~(i=this._events[n].indexOf(t))&&this._events[n].splice(i,1)},n.prototype.fireEvent=function(n){if(this._events[n])for(var t=0;t<this._events[n].length;t++)this._events[n][t].apply(null,[].slice.call(arguments,1))},n}),define("app/storage/Storage",[],function(){function t(r,u){var e,f,c,o,l={},y=[],s=[],a=[],h="_dnp_",p,w,v;for(e in r)if(r[e].constructor==Object)l[n[e]]=t(r[e],r);else if("coordinates"==e)if("Polygon"==r.type){for(f=0,o=0;f<r[e][0].length;f++,o+=2)s[o]=r[e][0][f][0],s[o+1]=r[e][0][f][1];l[n[e]]=s}else{for(f=0;f<r[e].length;f++){for(s=[],c=0,o=0;c<r[e][f][0].length;c++,o+=2)s[o]=r[e][f][0][c][0],s[o+1]=r[e][f][0][c][1];y[f]=s}l[n[e]]=y}else if("features"==e){if(h+="municipio"==u.type?"ml":"departamento"==u.type?"dl":"rl",p=+localStorage.getItem(h+"_up"),u.lastUpdated>p){for(f=0;f<r[e].length;f++)a[f]=r[e][f].properties.id,w=t(r[e][f],r),i(w);if(v=localStorage.getObject(h),v){for(f=0;f<a.length;f++)-1==v.indexOf(a[f])&&v.push(a[f]);localStorage.setObject(h,v)}else localStorage.setObject(h,a);localStorage.setItem(h+"_up",u.lastUpdated)}}else l[n[e]]=r[e];return l}function i(n){var t="_dnp_";t+="departamento"==n.p.t?"d_"+n.p.i:"municipio"==n.p.t?"m_"+n.p.i:"r_"+n.p.i,localStorage.setObject(t,n)}function r(n){var t,r,u,f=[],i;for("departments"==n?(t="_dnp_dl",r="_dnp_d_"):"municipalities"==n?(t="_dnp_ml",r="_dnp_m_"):(t="_dnp_rl",r="_dnp_r_"),u=localStorage.getObject(t)||[],i=0;i<u.length;i++)f[i]=localStorage.getObject(r+u[i]);return{features:f,lastUpdated:localStorage.getItem(t+"_up")}}var n={status:"s",lastUpdated:"l",type:"t",geojson:"g",features:"f",properties:"p",LAT:"LA",LON:"LO",name:"n",id:"i",geometry:"ge",coordinates:"c"};return{storeDataList:t,getDataList:r}}),define("app/utils/Modal",[],function(){function n(n){this.modal=$("<div>",{"class":"modal"})[0],this.back=$("<div>",{"class":"back"})[0],this.container=$("<div>",{"class":"container"})[0],this.wrapper=$("<div>",{"class":"wrapper"})[0],this.content=$("<div>",{"class":"content"})[0],"string"==typeof n?this.content.innerHTML=n:"object"==typeof n&&$(this.content).append(n),this.wrapper.appendChild(this.content),this.back.appendChild(this.wrapper),this.modal.appendChild(this.back),$(this.wrapper).on("click",function(n){n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}),$(this.back).on("click",this.hide.bind(this)),$(this.wrapper).on("click",".close",this.hide.bind(this))}return n.prototype.show=function(){$("html").css("overflow","hidden"),document.body.appendChild(this.modal),this.modal.style.display="block"},n.prototype.hide=function(){$("html").css("overflow","visible"),this.modal.style.display="none",document.body.removeChild(this.modal)},n.prototype.getElement=function(){return this.modal},n}),define("lib/jquery/mockjax",[],function(){!function(n){function s(t){var i,u,f;void 0==window.DOMParser&&window.ActiveXObject&&(DOMParser=function(){},DOMParser.prototype.parseFromString=function(n){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(n),t});try{if(i=(new DOMParser).parseFromString(t,"text/xml"),!n.isXMLDoc(i))throw"Unable to parse XML";if(u=n("parsererror",i),1==u.length)throw"Error: "+n(i).text();}catch(r){return f=void 0==r.name?r:r.name+": "+r.message,n(document).trigger("xmlParseError",[f]),void 0}return i}function u(t,i,r){(t.context?n(t.context):n.event).trigger(i,r)}function f(t,i){var r=!1;return"string"==typeof i?n.isFunction(t.test)?t.test(i):t==i:(n.each(t,function(u){return void 0===i[u]?r=!1:(r=!0,"object"==typeof i[u]?f(t[u],i[u]):r=n.isFunction(t[u].test)?t[u].test(i[u]):t[u]==i[u])}),r)}function h(t,i){if(n.isFunction(t))return t(i);if(n.isFunction(t.url.test)){if(!t.url.test(i.url))return null}else{var r=t.url.indexOf("*");if(t.url!==i.url&&-1===r||!new RegExp(t.url.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".+")).test(i.url))return null}return t.data&&i.data&&!f(t.data,i.data)?null:t&&t.type&&t.type.toLowerCase()!=i.type.toLowerCase()?null:t}function c(t,i){if(window.console&&console.log){var r="MOCK "+i.type.toUpperCase()+": "+i.url,u=n.extend({},i);if("function"==typeof console.log)console.log(r,u);else try{console.log(r+" "+JSON.stringify(u))}catch(f){console.log(r)}}}function l(t,i,u){var f=function(r){return function(){return function(){this.status=t.status,this.statusText=t.statusText,this.readyState=4,n.isFunction(t.response)&&t.response(u),"json"==i.dataType&&"object"==typeof t.responseText?this.responseText=JSON.stringify(t.responseText):"xml"==i.dataType?this.responseXML="string"==typeof t.responseXML?s(t.responseXML):t.responseXML:this.responseText=t.responseText,("number"==typeof t.status||"string"==typeof t.status)&&(this.status=t.status),"string"==typeof t.statusText&&(this.statusText=t.statusText),n.isFunction(this.onreadystatechange)?(t.isTimeout&&(this.status=-1),this.onreadystatechange(t.isTimeout?"timeout":void 0)):t.isTimeout&&(this.status=-1)}.apply(r)}}(this);t.proxy?r({global:!1,url:t.proxy,type:t.proxyType,data:t.data,dataType:"script"===i.dataType?"text/plain":i.dataType,complete:function(n){t.responseXML=n.responseXML,t.responseText=n.responseText,t.status=n.status,t.statusText=n.statusText,this.responseTimer=setTimeout(f,t.responseTime||0)}}):i.async===!1?f():this.responseTimer=setTimeout(f,t.responseTime||50)}function a(t,i,r,u){return t=n.extend(!0,{},n.mockjaxSettings,t),"undefined"==typeof t.headers&&(t.headers={}),t.contentType&&(t.headers["content-type"]=t.contentType),{status:t.status,statusText:t.statusText,readyState:1,open:function(){},send:function(){u.fired=!0,l.call(this,t,i,r)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(n,i){t.headers[n]=i},getResponseHeader:function(n){return t.headers&&t.headers[n]?t.headers[n]:"last-modified"==n.toLowerCase()?t.lastModified||(new Date).toString():"etag"==n.toLowerCase()?t.etag||"":"content-type"==n.toLowerCase()?t.contentType||"text/plain":void 0},getAllResponseHeaders:function(){var i="";return n.each(t.headers,function(n,t){i+=n+": "+t+"\n"}),i}}}function v(n,t,r){var f;if(y(n),n.dataType="json",n.data&&i.test(n.data)||i.test(n.url)){w(n,t);var u=/^(\w+:)?\/\/([^\/?#]+)/.exec(n.url),e=u&&(u[1]&&u[1]!==location.protocol||u[2]!==location.host);if(n.dataType="script","GET"===n.type.toUpperCase()&&e)return f=p(n,t,r),f?f:!0}return null}function y(n){"GET"===n.type.toUpperCase()?i.test(n.url)||(n.url+=(/\?/.test(n.url)?"&":"?")+(n.jsonp||"callback")+"=?"):n.data&&i.test(n.data)||(n.data=(n.data?n.data+"&":"")+(n.jsonp||"callback")+"=?")}function p(t,i,r){var f=r&&r.context||t,u=null;return i.response&&n.isFunction(i.response)?i.response(r):"object"==typeof i.responseText?n.globalEval("("+JSON.stringify(i.responseText)+")"):n.globalEval("("+i.responseText+")"),e(t,i),o(t,i),n.Deferred&&(u=new n.Deferred,"object"==typeof i.responseText?u.resolveWith(f,[i.responseText]):u.resolveWith(f,[n.parseJSON(i.responseText)])),u}function w(n,t){jsonp=n.jsonpCallback||"jsonp"+d++,n.data&&(n.data=(n.data+"").replace(i,"="+jsonp+"$1")),n.url=n.url.replace(i,"="+jsonp+"$1"),window[jsonp]=window[jsonp]||function(i){data=i,e(n,t),o(n,t),window[jsonp]=void 0;try{delete window[jsonp]}catch(r){}head&&head.removeChild(script)}}function e(n,t){n.success&&n.success.call(callbackContext,t.response?t.response.toString():t.responseText||"",status,{}),n.global&&u(n,"ajaxSuccess",[{},n])}function o(t){t.complete&&t.complete.call(callbackContext,{},status),t.global&&u("ajaxComplete",[{},t]),t.global&&!--n.active&&n.event.trigger("ajaxStop")}function b(i,u){var s,f,e,o;for("object"==typeof i?(u=i,i=void 0):u.url=i,f=n.extend(!0,{},n.ajaxSettings,u),o=0;o<t.length;o++)if(t[o]&&(e=h(t[o],f)))return c(e,f),"jsonp"===f.dataType&&(s=v(f,e,u))?s:(e.cache=f.cache,e.timeout=f.timeout,e.global=f.global,k(e,u),function(t,i,u,f){s=r.call(n,n.extend(!0,{},u,{xhr:function(){return a(t,i,u,f)}}))}(e,f,u,t[o]),s);return r.apply(n,[u])}function k(n,t){var i,f;if(!(!n.url instanceof RegExp)&&n.hasOwnProperty("urlParams")&&(i=n.url.exec(t.url),1!==i.length)){i.shift();var r=0,e=i.length,o=n.urlParams.length,s=Math.min(e,o),u={};for(r;s>r;r++)f=n.urlParams[r],u[f]=i[r];t.urlParams=u}}var r=n.ajax,t=[],i=/=\?(&|$)/,d=(new Date).getTime();n.extend({ajax:b}),n.mockjaxSettings={log:function(){if(window.console&&window.console.log){var n=Function.prototype.bind.call(console.log,console);n.apply(console,arguments)}},status:200,statusText:"OK",responseTime:500,isTimeout:!1,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}},n.mockjax=function(n){var i=t.length;return t[i]=n,i},n.mockjaxClear=function(n){1==arguments.length?t[n]=null:t=[]},n.mockjax.handler=function(n){if(1==arguments.length)return t[n]}}(window.jQuery)}),define("app/network/Services",["./urlsMap","../storage/Storage","app/utils/Modal","lib/jquery/mockjax"],function(n,t,i){function c(n){return n in document.documentElement.style}function u(n,t,u,f){if(f=f||a,h){var e=$.ajax({url:n,data:t,settings:{cache:l(n,t)}});return e.pipe(function(n,t){if(n.status||"abort"==t)"abort"!=t&&"console"in window&&window.console.log("Harmless Warning: Request Aborted");else{var r=new i(nt(n));r.show(),"console"in window&&window.console.log(n.message)}return n.status},function(n,t){return n.status||"abort"==t?"abort"!=t&&"console"in window&&window.console.log("Harmless Warning: Request Aborted"):"console"in window&&window.console.log(n.message),!n.status}),e.fail(f).error(f),u&&e.done(u),e}return r.push({url:n,data:t,callback:u,errorCb:f,done:function(n){this.cb=this.cb||[],this.cb.push(n)}}),r[r.length-1]}function l(n,t){var i=n+"::"+JSON.stringify(t);return s[i]?!0:(s[i]=!0,!1)}function a(){}function e(i,r,f){var e=f&&f.lastUpdated?{lastUpdated:f.lastUpdated}:{};u(n[i],e,function(n){if(n.geojson&&n.geojson.features)try{g?r(n.geojson):(t.storeDataList(n),r(t.getDataList(i)))}catch(u){"console"in window&&(window.console.log("Harmless Warning: Quota Exceded!"),window.console.log("Harmless Warning: Quota exceded storing: "+n)),"localStorage"in window&&window.localStorage.clear(),r(n.geojson)}else r(f)})}function f(n,i){var r=t.getDataList(n);r.features.length?e(n,i,r):e(n,i)}function v(n){f("departments",n)}function y(n){f("regions",n)}function p(n){f("municipalities",n)}function w(){return u(n.filtersProjects)}function b(t){return u(n.searchProjects,t)}function k(t){return u(n.searchProjectsList,t)}function d(t){return u(n.consolidated,t)}var o=!!$(document.body).attr("data-debug"),s={},h=!o,r=[],g=!1||c("msTransform"),nt=doT.compile('<div class="error"><h1>Error<\/h1><p>{{=it.message}}<\/p><div class="txt-right"><a class="button close">Cerrar<\/a><\/div><\/div>');return o&&require(["app/network/debugQueries"],function(){var n,t;if(h=!0,r.length)for(n=0;n<r.length;n++)t=u(r[n].url,r[n].data,r[n].callback,r[n].errorCb),r[n].cb&&t.done(r[n].cb)}),{polygons:{getDepartments:v,getRegions:y,getMunicipalities:p},filters:{forProjects:w},search:{projects:b,projectsList:k},infograph:{consolidated:d}}}),define("app/map/MapState",["lib/mvc/Observable","app/network/Services"],function(n,t){var i=new Class(n,{zoom:null,corners:null,filters:null,query:"",timeout:null,firstTime:!0,listMode:null,projectsReq:null,cornersBackup:null,initialize:function(){},setZoom:function(n){this.listMode&&this.setListMode(!1),this.zoom=n,this.updateQueryTimed()},setCorners:function(n,t){t?(this.corners=n,this.setListMode(!0,t)):(this.cornersBackup=n,this.corners=n,this.setListMode(!1))},setFiltersString:function(n){this.setListMode(!1),this.filters=n,this.updateQueryTimed()},setQuery:function(n){this.setListMode(!1),this.query=n||"",this.updateQueryTimed()},setPage:function(n){this.page=n,this.updateQueryTimed()},updateQuery:function(){var n="";return this.firstTime?(this.firstTime=!1,void 0):(this.query&&(n+="query="+this.query),this.page&&(n+="&page="+this.page),this.zoom&&!this.listMode&&(n+="&zoom="+this.zoom),!this.corners||this.listMode&&!this.listMode.isGroup||(n+="&topLeft="+this.corners[0][0]+","+this.corners[0][1],n+="&bottomRight="+this.corners[1][0]+","+this.corners[1][1]),this.filters&&(n+="&"+this.filters),n=n.replace(/(?:^&)|(?:&$)/g,""),this.listMode?t.search.projectsList(n).done(this.projectsListLoaded.bind(this)):(this.projectsReq&&4!=this.projectsReq.readystate&&(this.projectsReq.abort&&this.projectsReq.abort(),this.fireEvent("load-projects-aborded",n)),this.projectsReq=t.search.projects(n),this.projectsReq.done(this.projectsLoaded.bind(this)),this.fireEvent("loading-projects",n)),void 0)},updateQueryTimed:function(){clearTimeout(this.timeout),this.timeout=setTimeout(this.updateQuery.bind(this),0)},projectsLoaded:function(n){this.fireEvent("projects-loaded",n)},projectsListLoaded:function(n){this.fireEvent("projects-list-loaded",n)},setListMode:function(n,t){n?(this.listMode=t?{isGroup:!0}:{},$("#map-view").hide(),$("#projects-list-view").show(),$("#controls").addClass("list-mode").animate({marginLeft:0,left:0})):(this.listMode=null,this.page=0,$("#projects-list-view").hide(),$("#map-view").show(),$("#controls").removeClass("list-mode"),this.corners=this.cornersBackup),this.updateQueryTimed(t)}});return new i}),define("app/map/Infobox",[],function(){function r(n){t=new Microsoft.Maps.Point(n.getX(),n.getY())}function n(n,t,i,u){this._type=n,this._map=t,this._entity=i,this.name=u.name,this.id=u.id,this._content=$.extend(null,u),Microsoft.Maps.Events.addThrottledHandler(i._polygon||i,"click",this.clickHandler.bind(this),200),Microsoft.Maps.Events.addHandler(t,"mousedown",r),Microsoft.Maps.Events.addHandler(t,"viewchange",this.hide.bind(this))}var t,i={info:doT.compile($("#template-infobox-info")[0].innerHTML),project:doT.compile($("#template-infobox-project")[0].innerHTML),group:doT.compile($("#template-infobox-group")[0].innerHTML)},u=jQuery.browser.msie&&jQuery.browser.version.match(/^9/),f=jQuery.browser.msie&&jQuery.browser.version.match(/^10/);return n.prototype.show=function(n){var i,t,r=$("#header")[0].offsetHeight;this._map.visibleInfobox&&this._map.visibleInfobox.hide(),this.createElement(),this._elem.appendTo(document.body),this._elem.find(".button").on("click",this.viewMoreHandler.bind(this)),"info"==this._type?(("number"!=typeof n.pageX||isNaN(n.pageX))&&(n.pageX=n.originalEvent.x,n.pageY=n.originalEvent.y),(f||u)&&(n.pageY=n.pageY+window.pageYOffset),this._elem.css({display:"block",left:n.pageX,top:n.pageY}).removeClass("to-the-left").removeClass("to-the-top"),window.outerWidth-n.pageX-this._elem[0].offsetWidth<0&&this._elem.css({left:n.pageX-this._elem[0].offsetWidth}).addClass("to-the-left"),window.outerHeight-n.pageY-this._elem[0].offsetHeight+r<0&&this._elem.css({top:n.pageY-this._elem[0].offsetHeight+30}).addClass("to-the-top")):"project"==this._type?(i=this._entity.getLocation(),t=this._map.tryLocationToPixel(i,Microsoft.Maps.PixelReference.control),this._elem.css({display:"block",left:t.x,top:t.y}).removeClass("to-the-left").removeClass("to-the-top"),window.outerWidth-t.x-this._elem[0].offsetWidth<0&&this._elem.css({left:t.x-this._elem[0].offsetWidth}).addClass("to-the-left"),window.outerHeight-t.y-this._elem[0].offsetHeight+r<0&&this._elem.css({top:t.y-this._elem[0].offsetHeight+43}).addClass("to-the-top")):"group"==this._type&&(i=this._entity.getLocation(),t=this._map.tryLocationToPixel(i,Microsoft.Maps.PixelReference.control),this._elem.css({display:"block",left:t.x,top:t.y}).removeClass("to-the-left").removeClass("to-the-top"),window.outerWidth-t.x-this._elem[0].offsetWidth<0&&this._elem.css({left:t.x-this._elem[0].offsetWidth}).addClass("to-the-left"),window.outerHeight-t.y-this._elem[0].offsetHeight+r<0&&this._elem.css({top:t.y-this._elem[0].offsetHeight+43}).addClass("to-the-top")),this._map.visibleInfobox=this,this.visible=!0,n instanceof Event&&(n.stopPropagation?n.stopPropagation():window.event.cancelBubble=!0)},n.prototype.hide=function(){this._elem&&this.visible&&(this._elem.css({display:"none"}),this.visible=!1,this._elem.remove())},n.prototype.clickHandler=function(n){var i=new Microsoft.Maps.Point(n.getX(),n.getY()),r=Math.sqrt(Math.pow(i.x-t.x,2),Math.pow(i.y-t.y,2));r>5||(this.toggle(n),n instanceof Event&&(n.stopPropagation?n.stopPropagation():window.event.cancelBubble=!0))},n.prototype.viewMoreHandler=function(n){return"group"==this._type?(this._entity.viewGroupList({latitude:this._content.latitude,longitude:this._content.longitude}),this.hide()):(this._entity.panIntoView&&(n=n.originalEvent,this._entity.panIntoView(),n.preventDefault?n.preventDefault():n.returnValue=!1),this._entity.select&&this._entity.select()),!1},n.prototype.toggle=function(n){this.visible?this.hide(n):this.show(n)},n.prototype.updateContent=function(n){n.name=this.name,this._content=$.extend(null,n),this._elem&&this.hide()},n.prototype.createElement=function(){var n=this._type,t=this._content,u=i[n]?i[n](t):t,r=document.createElement("div");r.innerHTML=u,this._elem=r.childNodes[0],this._elem.style.display="none",this._elem=$(this._elem)},n}),define("app/map/Polygon",["lib/mvc/Observable","./Infobox"],function(n,t){function u(n,t){var i,e,r,u,f,o=[];if(t)for(r=[n[1],n[0]],u=r,f=Math.min(n.length),i=0,e=0;f>i;i+=2,e++)o[e]=new Microsoft.Maps.Location(n[i+1],n[i]),r=[Math.min(r[0],n[i+1]),Math.min(r[1],n[i])],u=[Math.max(u[0],n[i+1]),Math.max(u[1],n[i])];else for(r=[n[0][0][1],n[0][0][0]],u=r,f=Math.min(n[0].length),i=0;f>i;i++)o[i]=new Microsoft.Maps.Location(n[0][i][1],n[0][i][0]),r=[Math.min(r[0],n[0][i][1]),Math.min(r[1],n[0][i][0])],u=[Math.max(u[0],n[0][i][1]),Math.max(u[1],n[0][i][0])];return{locations:o,leftTopPoint:r,rightBottomPoint:u}}function i(n){var t=n.match(/\d+(?:\.\d+)?/g);return new Microsoft.Maps.Color(~~(255*t[3]),t[0],t[1],t[2])}var r=new Class(n,{initialize:function(n,t,u,f,e){var o,h=i("rgba("+r.baseRGB+",0.55)"),c=i("rgba("+r.strokeRGB+",1)"),l=t.strokeThickness||1,s=[];this._highlightColor=i("rgba("+r.baseRGB+",0)"),this._fillColor=t.fillColor?i(t.fillColor):h,this._strokeColor=t.strokeColor?i(t.strokeColor):c,o={fillColor:this._fillColor,strokeColor:this._strokeColor,strokeThickness:l},"municipalities"!=e?s=this.generatePolygon(t.coords,u):(this.coords=t.coords,this.isLight=u),this._polygon=new Microsoft.Maps.Polygon(s,o),this._polygon.Polygon=this,Microsoft.Maps.Events.addHandler(this._polygon,"mouseover",this.highlightPolygon.bind(this)),Microsoft.Maps.Events.addHandler(this._polygon,"mouseout",this.restorePolygon.bind(this)),window.test=this._polygon,this.config=t,this.id=f,this.type=e,this._map=n,this.createInfobox()},generatePolygon:function(n,t){var i,r="undefined"==typeof n;if(!this.generated)return n=n||this.coords,t=t||this.isLight,i=u(n,t),this._leftTopPoint=i.leftTopPoint,this._rightBottomPoint=i.rightBottomPoint,this._leftTopPoint=[this._leftTopPoint[0],this._leftTopPoint[1]],this._center=new Microsoft.Maps.Location((this._leftTopPoint[0]+this._rightBottomPoint[0])/2,(this._leftTopPoint[1]+this._rightBottomPoint[1])/2),this.coords=void 0,this.isLight=void 0,this.generated=!0,r?(this._polygon.setLocations(i.locations),void 0):i.locations},highlightPolygon:function(){this._polygon.setOptions({fillColor:this._highlightColor,strokeThickness:2})},restorePolygon:function(){this._polygon.setOptions({fillColor:this._fillColor,strokeThickness:1})},getCoordinates:function(){return this.generated||this.generatePolygon(this.coords,this.isLight),[new Microsoft.Maps.Location(this._leftTopPoint[0],this._leftTopPoint[1]-(this._rightBottomPoint[1]-this._leftTopPoint[1])/2),new Microsoft.Maps.Location(this._rightBottomPoint[0],this._rightBottomPoint[1])]},setCoordinates:function(n,t){this._leftTopPoint=n,this._rightBottomPoint=t},hide:function(){this._polygon.setOptions({visible:!1}),this._infobox.hide()},show:function(){this._polygon.setOptions({visible:!0})},getPolygon:function(){return this.generatePolygon(),this._polygon},getInfobox:function(){return this._infobox},createInfobox:function(){return this._infobox=new t("info",this._map,this,this.config.content),this._polygon.setOptions({infobox:this._infobox}),this._infobox},updateInfobox:function(n){return this._infobox.updateContent(n),this._infobox},panIntoView:function(){var n=this.getCoordinates(),t=new Microsoft.Maps.LocationRect.fromCorners(n[0],n[1]);this._map.setView({bounds:t})},updateColor:function(n){this._fillColor=this._strokeColor=i(n),this._polygon.setOptions({fillColor:this._fillColor})},select:function(){this.fireEvent("selected",this.id,this.type)}});return r.baseRGB="200, 187, 137",r.strokeRGB="180, 160, 125",r}),define("app/map/Pushpin",["./Infobox"],function(n){function t(){var n=this.getLocation();this._map.setView({center:n,zoom:20})}function i(i,r,u){var l,h,f,c=document.createElement("div"),e=Raphael(c,50,50),o=i.count||1,s=15,a=jQuery.browser.msie&&jQuery.browser.version.match(/^8/);return jQuery.browser.msie&&jQuery.browser.version.match(/^10/),jQuery.browser.safari,c.className="pushpin-container",navigator.userAgent.match(/firefox/gi)&&(s=31),a&&(s=26),h=o>100?18:o>10?15:12,e.circle(25,25,Math.round(1.25*h)).attr({fill:"#3ab54a",stroke:"#3ab54a"}),e.circle(25,25,h).attr({fill:"#3ab54a",stroke:"#fff","stroke-width":2}),a?e.text(25,s,o).attr({stroke:"#3ab54a","stroke-width":0,fill:"#fff","text-anchor":"middle","font-size":"15px"}):e.text(25,s,o).attr({stroke:"#3ab54a","stroke-width":0,fill:"#fff","text-anchor":"middle","font-size":"15px"}),l=c.outerHTML,f=new Microsoft.Maps.Pushpin(i,{htmlContent:l,zIndex:99}),f.map=r,"project"==i.type?f._infobox=new n(i.type,r,f,i):i.UsanMismaGeorefenciacion?f._infobox=new n(i.type,r,f,i):Microsoft.Maps.Events.addHandler(f,"click",function(){r.setView({zoom:r.getZoom()+2,center:f.getLocation()})}),i.url&&(f.panIntoView=t),f.viewGroupList=function(n){u.viewGroupList(n)},f}return i}),define("app/map/ListView",["./MapState"],function(n){function t(){this.root=$("#projects-list-view"),this.projects=ko.observableArray([]),n.on("projects-list-loaded",this.projectsListLoaded.bind(this)),this.root.find(".pagination").on("click","a",this.loadPage),this.root.find(".back").on("click",this.toMapMode),this.pages=ko.observableArray([]),this.actual=0}t.prototype.pageNumberTempl=doT.compile('<a href="#" class="{{? it.active}}active{{?}}" data-page="{{=it.page}}">{{=it.page}}<\/a>'),t.prototype.projectsListLoaded=function(n){this.projects(n.objects),this.pages([]),this.drawPages(+n.pageNumber,+n.totalPages),$("html, body").animate({scrollTop:$("#controls").offset().top},300)},t.prototype.loadPage=function(){return n.setPage(this.getAttribute("data-page")),!1},t.prototype.toMapMode=function(){return n.setListMode(!1),!1},t.prototype.drawPages=function(n,t){var i,r="",u=5;if(this.actual=n,n>1&&(r+='<a class="prev" href="#" data-page="'+(n-1)+'">&lt;<\/a>'),15>t)for(i=1;t>=i;i++)r+=this.pageNumberTempl({page:i,active:i==n});else{for(i=1;u>i;i++)r+=this.pageNumberTempl({page:i,active:i==n});if(n>u+1&&t-u>n)r+="...",r+=this.pageNumberTempl({page:n-1,active:i==n}),r+=this.pageNumberTempl({page:n,active:!0}),r+=this.pageNumberTempl({page:n+1,active:i==n}),r+="...";else if(t-u>n){for(i=u;u+2>=i;i++)r+=this.pageNumberTempl({page:i,active:i==n});r+="..."}else for(r+="...",i=t-7;t-u>=i;i++)r+=this.pageNumberTempl({page:i,active:i==n});for(i=t-u+2;t>=i;i++)r+=this.pageNumberTempl({page:i,active:i==n})}t>n&&(r+='<a class="next" href="#" data-page="'+(n+1)+'">&gt;<\/a>'),this.root.find(".pagination").html(r)};var i=new t;ko.applyBindings(i,i.root[0])}),define("app/map/Map",["lib/mvc/Observable","./Polygon","./Pushpin","app/network/Services","./MapState","./ListView"],function(n,t,i,r,u){function f(n){function ot(){o=new Microsoft.Maps.Map(n,{credentials:"Ah7mafuzHQjBcBfHXRNcyucmUVbzczI7SPzmWvoXhIxnDH-4fUcSKiPpR2kcDZLn",zoom:d,showMapTypeSelector:!1,center:ft,enableSearchLogo:!1,enableClickableLogo:!1,mapTypeId:Microsoft.Maps.MapTypeId.road}),Microsoft.Maps.Events.addHandler(o,"mousewheel",function(n){return n.handled=!0,!0}),Microsoft.Maps.Events.addHandler(o,"click",function(){f.fireEvent("click",o)}),Microsoft.Maps.Events.addThrottledHandler(o,"viewchangeend",it,600),r.polygons.getDepartments(b("departments")),f.showSpinner(),r.polygons.getRegions(b("regions")),f.showSpinner(),r.polygons.getMunicipalities(b("municipalities")),it(),f.ready=!0,f.fireEvent("ready",f),y=new Microsoft.Maps.EntityCollection}function st(n,i,r){var l,b,u,p,a,o,k=r?"ge":"geometry",g=r?"c":"coordinates",nt=r?"t":"type",v=r?"p":"properties",w=r?"i":"id",d="regions"==i;for(s[i]=s[i]||{},h[i]=new Microsoft.Maps.EntityCollection,c[i]=new Microsoft.Maps.EntityCollection,h[i].setOptions({zIndex:1}),c[i].setOptions({zIndex:2}),y.setOptions({zIndex:9}),p=0;p<n.features.length;p++)if(l=n.features[p],b=l[k][g],"MultiPolygon"==l[k][nt]){for(o=[],a=0;a<b.length;a++)u=tt(b[a],l[v],r,l[v][w],i),u._leftTopPoint&&(o[a]=u,0===a?(o.leftTopPoint=u._leftTopPoint,o.rightBottomPoint=u._rightBottomPoint):(o.leftTopPoint=[Math.min(o.leftTopPoint[0],u._leftTopPoint[0]),Math.min(o.leftTopPoint[1],u._leftTopPoint[1])],o.rightBottomPoint=[Math.max(o.rightBottomPoint[0],u._rightBottomPoint[0]),Math.max(o.rightBottomPoint[1],u._rightBottomPoint[1])])),d&&u.updateColor("rgba("+t.baseRGB+","+e(p/n.features.length)+")"),s[i][l[v][w]]=s[i][l[v][w]]||[],s[i][l[v][w]].push(u),"municipalities"!==i&&h[i].push(u.getPolygon()),c[i].push(u.getInfobox());for(a=0;a<o.length;a++)o[a].setCoordinates(o.leftTopPoint,o.rightBottomPoint)}else u=tt(b,l[v],r,l[v][w],i),d&&u.updateColor("rgba("+t.baseRGB+","+p/n.features.length+")"),s[i][l[v][w]]=u,"municipalities"!==i&&h[i].push(u.getPolygon()),c[i].push(u.getInfobox());f.fireEvent("polygons-initialized",i)}function tt(n,i,r,u,e){var h=ht(i),s=new t(o,{coords:n,content:h.data},r,u,e);return Microsoft.Maps.Events.addHandler(s.getPolygon(),"click",function(n){f.fireEvent("click-on-polygon",n)}),s.on("selected",function(n,t){f.fireEvent("polygon-selected",n,t)}),s}function ht(n,t){var i,r,f,u={name:n.name||n.n,projectNumber:0,approvedMoney:0,id:n.id||n.i};if("departamento"==(n.type||n.t)){for(t=t||p.departments,r=0;r<t.length;r++)if(i=t[r],i.id===("id"in n?n.id:n.i)){u.approvedMoney=i.approvedMoney,u.projectNumber=i.projectNumber;break}}else if("region"==(n.type||n.t)){for(t=t||p.regions,r=0;r<t.length;r++)if(i=t[r],i.id===("id"in n?n.id:n.i)){u.approvedMoney=i.approvedMoney,u.projectNumber=i.projectNumber;break}}else if(t&&t[0])for(r=t.length;r--;)if(i=t[r],i.id===("id"in n?n.id:n.i)){u.approvedMoney=i.approvedMoney,u.projectNumber=i.projectNumber;break}return{data:u,color:f}}function ct(n,t,i){var r=Microsoft.Maps.LocationRect.fromCorners(n,t);o.setView({bounds:r,zoom:parseInt(i||d,10)})}function it(){var n,t,r=o.getCenter(),f=r.latitude+" "+r.longitude,e=o.getBounds(),i=o.getZoom();(0==i%1&&g!=i||rt!==f)&&(g=i,rt=f,u.setZoom(g),n=e.getNorthwest(),t=e.getSoutheast(),u.setCorners([[n.latitude,n.longitude],[t.latitude,t.longitude]]))}function b(n){return function(t){st(t,n,!t.type),k(),f.showSpinner(!1)}}function lt(n){function y(n,i){if(n){var f=n.id,r=i[f];if(r)if(n instanceof t)n.updateInfobox(r);else for(u=n.length;u--;)n[u].updateInfobox(r);else n.updateInfobox(it)}}var c,tt,r,u,d,l,g=!0,v={length:0},b={length:0},p={length:0},it=("rgba("+t.baseRGB+","+e(0)+")",{projectNumber:0,approvedMoney:0}),nt=Object.prototype.hasOwnProperty;if(w=[],n.objects)for(d=n.objects.length;d--;)c=n.objects[d],"municipio"==c.type?(v[c.id]=c,v.length+=1):"departamento"==c.type?(b[c.id]=c,b.length+=1):"region"==c.type?(p[c.id]=c,p.length+=1):w.push(new i(c,o,this));if(b.length||p.length){for(l in s.departments)if(nt.call(s.departments,l))if(r=s.departments[l],r instanceof t)y(r,b);else for(u=0;u<r.length;u++)y(r[u],b);for(l in s.regions)if(nt.call(s.regions,l))if(r=s.regions[l],tt=r.id,c=p[tt],r instanceof t)y(r,p);else for(u=0;u<r.length;u++)y(r[u],p);a=f.actualVisualization(),g=!1}if(v.length&&h.municipalities){h.municipalities.clear();for(l in v)if(nt.call(v,l))if(r=s.municipalities[l],r instanceof t)r.generatePolygon(),h.municipalities.push(r.getPolygon()),y(r,v);else if(r instanceof Array)for(u=0;u<r.length;u++)r[u].generatePolygon(),h.municipalities.push(r[u].getPolygon()),y(r[u],v);a="Municipality",g=!1}$("#filter-results .value").html(n.totalProjectsNumber),g&&(a=""),k()}function k(){var n;clearTimeout(ut),ut=setTimeout(function(){var t;for("Department"==a||"Region"==a?("Region"!=l&&"Department"!=l||f.actualVisualization()!=l)&&("Region"==f.actualVisualization()&&h.regions&&(l=f.actualVisualization(),o.entities.clear(),t=!0,o.entities.push(h.regions),o.entities.push(c.regions)),"Department"==f.actualVisualization()&&h.departments&&(l=f.actualVisualization(),o.entities.clear(),t=!0,o.entities.push(h.departments),o.entities.push(c.departments))):"Municipality"==a?"Municipality"!=l&&h.municipalities&&(l="Municipality",o.entities.clear(),t=!0,o.entities.push(h.municipalities),o.entities.push(c.municipalities)):l="",y.clear(),n=w.length;n--;)y.push(w[n]);et||o.entities.remove(y),o.entities.push(y),et=!1},100)}function at(){u.setListMode(!0)}var o,a,rt,l,y,ut,h={regions:null,departments:null,municipalities:null},s={},p={departments:JSON.parse(document.body.getAttribute("data-deparmentProjectData")),regions:JSON.parse(document.body.getAttribute("data-regionProjectData"))},c={regions:null,departments:null,municipalities:null},ft=new Microsoft.Maps.Location(4.3344012216447965,-77.76142578125),d=6,g=5,w=[],f=this,nt=$("<div>",{"class":"loader"}).appendTo($(".map-container")[0]),v=[],et=!0;f.actualVisualization=ko.observable("Department"),a=f.actualVisualization(),f.showSpinner=function(n){n!==!1&&v.push(1),n===!1&&v.length<2?(nt.fadeOut(),v=[]):n===!1?v.pop():nt.fadeIn()},f.hideSpinner=function(){v.length<2?(nt.fadeOut(),v=[]):v.pop()},u.on("projects-loaded",lt.bind(this)),u.on("projects-loaded",f.hideSpinner.bind(f)),u.on("loading-projects",f.showSpinner.bind(f)),u.on("load-projects-aborded",f.hideSpinner.bind(f)),$("#filter-results button").click(at),ot(),f.isRegion=ko.computed(function(){return"Region"==f.actualVisualization()},f.actualVisualization),f.toggleMode=function(){var t,n,i,r=0;for(f.actualVisualization("Region"==f.actualVisualization()?"Department":"Region"),f.hideInfoboxes(),k(),t="Department"==f.actualVisualization()?p.departments:p.regions,n=0;n<t.length;n++)i=t[n],r=Math.max(r,i.approvedMoney)},ko.applyBindings(f,$("#map-view-options .change-view-mode")[0]),this.zoomToTerritory=function(n,t){var e,i,c,r,u,h;if(t.length){if(e="municipio"==n?s.municipalities:"departamento"==n?s.departments:s.regions,!e)return this.on("polygons-initialized",function(i){i==n&&f.zoomToTerritory(n,t)}),void 0;if(r=e[t[0].value]){for(r instanceof Array&&(r=r[0]),i=r.getCoordinates(),h=1;h<t.length;h++)r=e[t[h].value],u=r.getCoordinates(),r instanceof Array&&(r=r[0]),i=[{latitude:Math.min(u[0].latitude,i[0].latitude),longitude:Math.min(u[0].longitude,i[0].longitude)},{latitude:Math.max(u[1].latitude,i[1].latitude),longitude:Math.max(u[1].longitude,i[1].longitude)}];c=new Microsoft.Maps.LocationRect.fromCorners(new Microsoft.Maps.Location(i[0].latitude,i[0].longitude),new Microsoft.Maps.Location(i[1].latitude,i[1].longitude)),o.setView({bounds:c})}}},this.zoomToColombia=function(){o.setView({center:ft,zoom:d,animate:!1})},this.hideInfoboxes=function(){var n,t,i;for(t in c)if(c.hasOwnProperty(t)&&(n=c[t]))for(i=n.getLength();i--;)n.get(i).hide()},this.panTo=ct,this.viewGroupList=function(n){u.setCorners([[n.latitude,n.longitude],[n.latitude,n.longitude]],!0)},u.on("projects-list-loaded",this.hideInfoboxes.bind(this))}function e(n){return(.15+.5*n).toFixed(2)}return f.prototype=new n,f}),define("app/grapher/Grapher",[],function(){function r(r,u,f,e){var h,o,a=Raphael(r,2.2*u,2.2*u),c=[],l=[],s={startFromFixedAngle:90,labels:e,minPercent:1e-5};if(f){for(f.length>t.length?(s.colors=n,s.stroke=n):(s.colors=t,s.stroke=t),o=0;o<f.length;o++)c[o]=f[o].rawValue,l[o]=f[o].value;return h=a.semiPiechart(1.1*u,1.1*u,u,c,s,l),h.hover(function(){this.sector.stop(),this.sector.animate({transform:"s1.1 1.1 "+this.cx+" "+this.cy},100),this.pop=i(this.sector,f[this.sector.value.order].label+" - "+f[this.sector.value.order].value+"<br />"+f[this.sector.value.order].rawValue.toCurrency(),e?19:44),this.pop.show()},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},200),this.pop.remove()}),h}}function u(t,r){var o,u=t.offsetWidth,f=.577*u,e=Raphael(t,u,f),s={};r&&(s.colors=n,o=e.barchart(50,10,u-100,f-50,r,s),o.hover(function(){var n=r[this.bar.value.order].rawValue;this.bar.stop(),this.bar.animate({transform:"s1.1 1 "+this.cx+" "+this.cy},100),this.pop=i(this.bar,r[this.bar.value.order].label+" - "+r[this.bar.value.order].value+"<br>"+n.toCurrency().replace(/\$\s*/,""),25,-20),this.pop.show()},function(){this.bar.animate({transform:"s1 1 "+this.cx+" "+this.cy},200),this.pop.remove()}),e.text(u/2,f-50,"Sectores").attr({"text-anchor":"middle",fill:"#999","font-size":"10px"}),e.text(8,f/2,"Número de Proyectos").attr({"text-anchor":"middle",fill:"#999","font-size":"10px"}).rotate(-90))}function i(n,t,i,r){var u=$("<div>",{"class":"graph-tooltip"}).html(t);return r=r||0,i=i||0,u.appendTo(document.body),u.css({top:$(n.paper.canvas).position().top+n.getBBox().y-u[0].offsetHeight+r,left:$(n.paper.canvas).position().left+n.getBBox().x+n.getBBox().width/2+i,display:"none"}),u}var n=["#6dcff6","#00bff3","#00adef","#0077a2","#00746b","#01a89e","#1cbcb4","#7accc8","#82ca9c","#3cb879","#00a652","#197b30","#598526","#8ec63f","#c4df9c","#fff568","#fef200","#aca000","#f7941d","#fbae5c","#f36523","#f25103","#f2361d","#f24257","#ee1475","#a72c7d","#662e91","#2e3192","#014a81","#458ccc","#014a81","#2e3192","#662e91","#a72c7d","#ee1475","#f24257","#f2361d","#f25103","#f36523","#fbae5c","#f7941d","#aca000","#fef200","#fff568","#c4df9c","#8ec63f","#598526","#197b30","#00a652","#3cb879","#82ca9c","#7accc8","#1cbcb4","#01a89e","#00746b","#0077a2","#00adef","#00bff3","#6dcff6"],t=["#FBA74D","#2280A2","#3BB778","#1CC1B3","#8EC63F","#fff568","#f36523"];return{drawSemiPie:r,drawBars:u}}),define("app/infographic/Infographic",["app/grapher/Grapher","app/network/Services"],function(n,t){function u(){this.initialize()}var f=JSON.parse($(document.body).attr("data-resourcesPerSector")),e=JSON.parse($(document.body).attr("data-resourcesPerRegion")),o=JSON.parse($(document.body).attr("data-projectsPerSector")),i=JSON.parse($(document.body).attr("data-resourcesPerDepartment")),s=doT.compile($("#template-graph-resdepto")[0].innerHTML),h=doT.compile($("#template-facts")[0].innerHTML),r=$("#infographic")[0];return u.prototype.reloadGraphs=function(n){t.infograph.consolidated(n).done(this.initialize.bind(this))},u.prototype.initialize=function(t){var l,u,a=$(r).find("#res-sector").empty()[0],v=$(r).find("#res-region").empty()[0],y=$(r).find("#proy-sector").empty()[0],p=$(r).find("#res-depto").empty(),c=0;if(f=t?t.resourcesPerSector:f,e=t?t.resourcesPerRegion:e,o=t?t.projectsPerSector:o,i=t?t.resourcesPerDepartment:i,l=n.drawSemiPie(a,135,f),n.drawSemiPie(v,180,e,!0),n.drawBars(y,o),i)for(u=0;u<i.length;u++)c=Math.max(i[u].rawValue,c);if(i)for(u=0;u<i.length;u++)i[u].valuePercent=~~(100*(i[u].rawValue/c))+"%";i&&(p[0].innerHTML=s({array:i})),t&&$(".facts").empty().html(h(t))},new u}),define("app/filters/Option",["lib/mvc/Observable"],function(n){return new Class(n,{initialize:function(n){$.extend(this,n),this.active=ko.observable(!1),this.visible=ko.observable(!0),this.important=ko.observable(!1)},toggleActive:function(){this.active(!this.active()),this.active()&&this.dependsOn&&this.fireEvent("require-activate",this.dependsOn),this.fireEvent("options-changed",this)},setActive:function(n,t){this.active("boolean"==typeof n?n:!0),t||this.fireEvent("options-changed",this,!0),this.dependsOn&&this.active()&&this.fireEvent("require-activate",this.dependsOn)},setVisibility:function(n){this.visible(n)},getName:function(){return this.name}})}),define("app/filters/FilterGroup",["lib/mvc/Observable","./Option"],function(n,t){var i=document.body.getAttribute("data-periods-default-text");return new Class(n,{initialize:function(n){var r,f=[],u;for($.extend(this,n),this.options=ko.observableArray(),u=0;u<this.items.length;u++)r=new t(this.items[u]),r.active.subscribe(this.setActive.bind(this)),r.on("require-activate",this.optionActivated.bind(this)),r.on("options-changed",this.optionActivatedByUser.bind(this)),f[u]=r;f.sort(this.alphabetSorting),this.options(f),this.active=ko.observable(!1),this.visible=ko.observable(!1),this.optionChanged=ko.observable(),this.elems={},this.getNameStatus=ko.computed(function(){for(var n,t="",i=this.options(),r=i.length;r--;)n=i[r],n.active()&&(t+=n.name+", ");return t?'<span class="no-bold">'+this.name+":  <\/span>"+t.replace(/\,\s$/,""):this.name},this),this.getNameDefault=ko.computed(function(){for(var n,t="",r=this.options(),u=r.length;u--;)n=r[u],n.active()&&(t+=n.name+", ");return t?t.replace(/\,\s$/,""):i},this),this.toggleVisibleBinded=this.toggleVisible.bind(this)},filter:function(){},toggleVisible:function(n,t){var i=t&&$(t.target),r=this.visible();i&&(this.elem=i),this.onToggle(),r?(t&&t.stopPropagation(),this.hide()):this.show(),t instanceof Event&&(t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0)},setActive:function(){var n=this.getActive();this.active(n.length),this.fireEvent("option-activated",this,n)},getActive:function(){for(var n,i=this.options(),r=[],t=0;t<i.length;t++)n=i[t],n.active()&&r.push(n);return r},disActive:function(){for(var n,t=this.options(),i=t.length;i--;)n=t[i],n.active()&&n.setActive(!1)},optionClicked:function(n,t){var i=t.target,r=ko.dataFor(i);$(t.target).hasClass("option")&&r.toggleActive()},optionActivated:function(n){this.fireEvent("activate-options-related",n)},optionActivatedByUser:function(n,t){for(var i,r=this.getActive(),u=r.length;u--;)i=r[u],-1==this.parameter.indexOf("period")&&n.value!==i.value&&i.setActive(!1,"ignoreNotification");t||this.fireEvent("activated-by-user",this.parameter,this.getActive())},getOptionByValue:function(n){for(var i=this.options(),t=0;t<i.length;t++)if(i[t].value===n)return i[t]},filterOptions:function(n,t){for(var i,u=t.target.value,f=this.options(),r=0;r<f.length;r++)i=f[r],i.setVisibility(!u||i.name.score(u)>0)},getQuery:function(){if(this.active()){for(var n,t=this.parameter+"=",i=this.options(),r=i.length;r--;)n=i[r],n.active()&&(t+=encodeURIComponent(n.value)+",");return t.replace(/\,$/,"")}return""},onToggle:function(){this.elem.parents(".filters-group").find(".filter-group").end().find("input").val("").keyup()},hide:function(){var n=this;this.onToggle(),$(document).off("click",this.toggleVisibleBinded),n.visible(!1),this.elem.hasClass("extra")?this.elem.next().slideUp(200,function(){$(this).hide().parent().removeClass("visible")}):this.elem.next().delay(100).animate({width:0},250,function(){$(this).hide().parent().removeClass("visible"),n.visible(!1)})},show:function(){var n=this;this.onToggle(),this.visible(!0),this.elem.hasClass("extra")?(this.elem.next().slideDown(200),setTimeout(function(){$(document).on("click",n.toggleVisibleBinded)},10)):this.elem.next().width(0).show().delay(100).animate({width:200},250),this.elem.parent().addClass("visible"),this.fireEvent("filters-gonna-show",this)},alphabetSorting:function(n,t){return n.name==t.name?0:n.name<t.name?-1:1},sortOptionsBy:function(n){var t,r=this.options(),i;for(this.filterByType||(this.filterByType=function(t){for(var u,r,i=0;i<n.length;i++)for(u=n[i].getActive(),r=0;r<u.length;r++)if(n[i].parameter==t.type&&u[r].value==t.id)return!0;return!1}),i=r.length;i--;)t=r[i],t.dependsOn?t.dependsOn.filter(this.filterByType).length?(t.sortBy=1+t.name,t.important(!0)):(t.sortBy=2+t.name,t.important(!1)):(t.sortBy=2+t.name,t.important(!1));this.options.sort(function(n,t){return n.sortBy==t.sortBy?0:n.sortBy<t.sortBy?-1:1})},selectOption:function(n){for(var t,i=this.options(),r=i.length;r--;)t=i[r],t.value==n?t.setActive(!0):-1==this.parameter.indexOf("period")&&t.setActive(!1,"ignoreNotification")}})}),define("app/utils/Utils",[],function(){return"console"in window||(window.console={data:[],log:function(){this.data.push([].slice.call(arguments))},warn:function(){this.data.push([].slice.call(arguments))},error:function(){this.data.push([].slice.call(arguments))}}),{}}),define("app/filters/Filters",["lib/mvc/Observable","app/network/Services","./FilterGroup","../map/MapState","app/utils/Utils","app/infographic/Infographic"],function(n,t,i,r,u,f){var e;return new Class(n,{project:"/proyectos",resources:"/recursos",initialize:function(){function i(){return this.visible=ko.observable(!0),this.toggleVisible=function(t){if("boolean"!=typeof t||t!==this.visible())return("boolean"==typeof t?this.visible(t):this.visible(!this.visible()),n.toggleControl(this.visible()),t instanceof Event&&(t.stopPropagation?t.stopPropagation():"boolean"!=typeof t&&(window.event.cancelBubble=!0)),!1)},!1}function u(){function t(){n.notifyNewSearch()}this.query=ko.observable(""),this.query.subscribe(t),this.search=t}var n=this;this.activated=!1,this.mode=null,this.elems={},this.elems.root=$("#controls"),this.elems.search=$("#search"),this.elems.filtersProjects=$("#filters-projects"),this.elems.filtersResources=$("#filters-resources"),this.elems.filterResults=$("#filter-results"),this.elems.resetFiltersWrapper=$("#reset-filters-wrapper"),this.elems.resetFilters=$("#reset-filters"),this.elems.initLink=$("#header .logo, #header .inicio, #footer .inicio"),this.elems.share=$("#share"),setTimeout(function(){t.filters.forProjects().done(n.initializeModels.bind(n))},0),setTimeout(function(){n.fireEvent("loading-filters")},20),r.on("projects-loaded",this.updateStatistics.bind(this)),this.searchQuery=new u,this.viewMode=new i,this.resetFilters=ko.observable(!1),ko.applyBindings(this.viewMode,$("#toggle-controls")[0]),ko.applyBindings(this.searchQuery,$("#search")[0]),this.elems.initLink.on("click",this.unselectAll.bind(this))},activate:function(n,t){var i=this.elems.root,r=i.find(".actions"),u=[];this.filtersProjects&&(u=this.filtersProjects().filter(function(n){return n.active()})),(t||n!==this.project||1!==u.length||"periods"!==u[0].parameter)&&(n===this.project||n===this.resources?(i.addClass("tabs-mode"),i.find(".statistics").addClass("small"),i.find(".intro").hide(),$("#filter-results").show(),this.elems.search.show(),this.elems.share.show()):(i.removeClass("tabs-mode"),i.find(".statistics").removeClass("small"),i.find(".intro").show(),$("#filter-results").hide(),this.elems.search.hide(),this.elems.share.hide()),$("#projects-list-view").hide(),$("#map-view").show(),$("#controls").removeClass("list-mode"),n===this.project?(this.mode=this.project,this.elems.filtersResources.hide(),this.elems.filtersProjects.show(),r.find(".search-resources").addClass("inactive").siblings().removeClass("inactive")):n===this.resources?(this.mode=this.resources,this.elems.filtersProjects.hide(),this.elems.filtersResources.show(),r.find(".search-projects").addClass("inactive").siblings().removeClass("inactive")):(this.mode=null,this.elems.filtersResources.hide(),this.elems.filtersProjects.hide(),r.find("a").removeClass("inactive")))},toggleControl:function(n){return this.activated=!0,n?this.elems.root.animate({marginLeft:0,left:0}):(this.elems.root.animate({marginLeft:0,left:-350}),this.hideAllFilters(),r.listMode&&r.setListMode(!1)),!1},initializeModels:function(n){var r=n.filters,u=[],t=this;r&&setTimeout(function(){for(var n,o=r.length,e=0;o>e;e++)n=new i(r[e]),u.push(n),n.on("activate-options-related",t.activateOptionsRelated.bind(t)),n.parameter.match(/(region)|(departamento)|(municipio)/)&&n.on("activated-by-user",t.activatedByUser.bind(t)),n.on("option-activated",t.notifyNewSearch.bind(t)),n.on("filters-gonna-show",t.checkActivated.bind(t)),("periods"==n.parameter||"periodos"==n.parameter)&&(ko.applyBindings(n,$("#map-select-period")[0]),ko.applyBindings(n,$("#info-select-period")[0]),ko.applyBindings(n,$("#filters-stats-info")[0]),n.on("option-activated",function(n){f.reloadGraphs(n.getQuery())}));t.filtersProjects=ko.observableArray(u),setTimeout(function(){ko.applyBindings(t,t.elems.filtersProjects[0]),ko.applyBindings(t,t.elems.resetFilters[0]),t.fireEvent("filters-loaded")},0)},0)},activateOptionsRelated:function(n){function u(i){return i.parameter===n[t].type}for(var r,i,t=0;t<n.length;t++)r=this.filtersProjects().filter(u),i=r[0].getOptionByValue(n[t].id),i&&i.setActive(!0,!0)},activatedByUser:function(n,t){this.fireEvent("territory-activated",n,t)},notifyNewSearch:function(){var n=this;clearTimeout(e),e=setTimeout(function(){var i="",u=n.filtersProjects(),t=0,f=[];for(r.setQuery(encodeURIComponent(n.searchQuery.query())),n.resetFilters(!1);t<u.length;t++)u[t].active()&&(f.push(u[t]),i+=u[t].getQuery()+"&",n.resetFilters(!0));f.length||n.searchQuery.query()?n.elems.resetFiltersWrapper.show():n.elems.resetFiltersWrapper.hide(),i=i.replace(/&$/,""),r.setFiltersString(i)},0)},unselectAll:function(n){if(this.filtersProjects){n!==!0&&this.fireEvent("filters-reseted");for(var t=this.filtersProjects(),i=t.length;i--;)t[i].disActive();$("html, body").animate({scrollTop:0},200),this.searchQuery.query(""),this.hideAllFilters()}},updateStatistics:function(n){var t=this.elems.root;this.fireEvent("loaded-filters"),this.activated||(t.animate({marginLeft:0,left:0}),this.activated=!0),t.find("#collected-money").html(parseInt(n.collectedMoney).toCurrency()),t.find("#approved-money").html(parseInt(n.approvedMoney).toCurrency()),t.find("#approved-projects").html(n.approvedProjects),t.find("#total-sources").html(parseInt(n.approvedMoneyTotal).toCurrency())},hideAllFilters:function(){if(this.filtersProjects)for(var n,t=this.filtersProjects(),i=t.length;i--;)n=t[i],n.visible()&&n.hide()},checkActivated:function(n){var t,r=this.filtersProjects(),u=[],i;for(this.fireEvent("filters-gonna-show",n),i=r.length;i--;)t=r[i],t.active()&&u.push(t),t.visible()&&t.parameter!=n.parameter&&t.hide();n.sortOptionsBy(u)},select:function(n,t){var r,i,u,f;if(!(!window.history||!window.history.pushState),"query"==n)this.searchQuery.query(t);else for(r=this.filtersProjects(),u=r.length;u--;)if(i=r[u],i.parameter===n)if(t instanceof Array)for(f=t.length;f--;)i.selectOption(t[f]);else i.selectOption(t)}})}),require(["app/map/MapState","app/map/Map","app/infographic/Infographic","app/filters/Filters","app/utils/Modal"],function(n,t,i,r,u){function v(){o.forceCleanup=!0}function y(){var n,r,i,h,u,o,s,t;if(n=window.location.hash.match(/\?.+/)){for(n=n[0].substr(1).split("&"),n="string"==typeof n?[n]:n,t=0;t<n.length;t++)s=n[t].split("="),r=s[0],i=s[1],"zoom"==r?h=i:"topLeft"==r?(u=new Microsoft.Maps.Location(i.split(",")[0],i.split(",")[1]),o=new Microsoft.Maps.Location(n[t+1].split("=")[1].split(",")[0],n[t+1].split("=")[1].split(",")[1]),t++):i&&e.select(r,i.split(","));f.ready?f.panTo(u,o,h):f.on("ready",function(){f.panTo(u,o)}),e.notifyNewSearch()}}function c(n){e.activate(e.project,n)}function l(){e.activate()}function s(){$("#header nav a").removeClass("selected");var n=location.href;n.match(/\/proyectos\/?/)?$("#header nav .projects").addClass("selected"):n.match(/\/recursos\/?/)?$("#header nav .resources").addClass("selected"):$("#header nav .inicio").addClass("selected")}function p(n){var i=(n.split("&"),location.origin),t=encodeURIComponent(i+"/proyectos/?"+n);t=encodeURIComponent(window.location),$("#share .facebook").attr("href","http://www.facebook.com/sharer.php?u="+t+"&t=Sistema%20General%20de%20Regalías"),$("#share .twitter").attr("href","http://twitter.com/intent/tweet?\t\t\ttext="+encodeURIComponent("Realizé una búsqueda en @Regalias_gov ")+"&url="+t+"&t=Sistema%20General%20de%20Regalías"),$("#share .email").attr("href","mailto:contactenosMapaRegalias@dnp.gov.co?\t\t\tsubject=Sistema General de Regalías&\t\t\tbody=Realizé una búsqueda en Sistema General de  Regalías: "+t),window.location.hash=h?"#/":"/proyectos/?"+n}var h,f=new t(document.getElementById("map-div")),e=new r,a=$.browser.safari,w=!!navigator.userAgent.match(/windows/i),b=doT.compile('<div class="error"><h1>Información<\/h1><p>{{=it.message}}<\/p><div class="txt-right"><a class="button close">Cerrar<\/a><\/div><\/div>'),o;a&&(document.body.className+=" is-safari"),w&&a&&(document.body.className+=" is-safari-windows"),f.on("click",function(){e.hideAllFilters()}),f.on("polygon-selected",function(n,t){"departments"==t?t="departamento":"municipalities"==t?t="municipio":"regions"==t&&(t="region"),e.select(t,n)}),n.on("loading-projects",p),e.on("territory-activated",f.zoomToTerritory.bind(f)),e.on("filters-reseted",f.zoomToColombia.bind(f)),e.on("filters-reseted",v),e.on("loading-filters",f.showSpinner.bind(f)),e.on("filters-loaded",f.hideSpinner.bind(f)),e.on("filters-loaded",y),e.on("filters-gonna-show",f.hideInfoboxes.bind(f)),o=(!(!window.history||!window.history.pushState),Router()),$("#header nav .inicio, #header .logo").click(function(){return window.location.hash="#/",!1}),o.historyList=[],o.configure({on:function(){var t=this.getRoute(),i=this.historyList.length-1,n=this.historyList[i];n&&t[0]==n[0]&&!t[1]&&n[1]?window.location.hash="/"+n.join("/"):this.historyList.push(t)}}),o.on("/",function(){s(),l(),e.unselectAll.call(e),h=!0,setTimeout(function(){h=!1},900)}),o.on(/\/templates\/?$/,function(){s(),l()}),o.on(/\/proyectos\/?/,function(){s(),c(!0)}),o.on(/\/proyectos\/.+/,function(){s(),c(!1)}),o.on(/\/recursos\/?/,function(){history in window?history.back():window.location.hash="/proyectos";var n=new u(b({message:"Esta funcionalidad se encuentra en construcción <br /><br />"}));n.show()}),window.location.hash||(window.location.hash="/"),o.init(),$("#share .print").on("click",function(){return print(),!1}),$("[placeholder]").placeholder()});
//@ sourceMappingURL=main.min.js.map